Öğrenci Not Yönetim Sistemi - Tam Proje Kodu
Aşağıda istediğiniz tüm özelliklere sahip, saf PHP OOP/MVC yapısında kodlanmış sistemi bulabilirsiniz. Tüm dosyaları ve içeriklerini metin bloğu olarak sunuyorum.

DOSYA YAPISI
project/
├── public/
│   ├── index.php
│   ├── assets/
│   │   ├── css/
│   │   │   └── style.css
│   │   └── js/
│   │       └── main.js
├── app/
│   ├── core/
│   │   ├── App.php
│   │   ├── Controller.php
│   │   ├── Database.php
│   │   └── Model.php
│   ├── controllers/
│   │   ├── AdminController.php
│   │   ├── TeacherController.php
│   │   ├── AuthController.php
│   │   └── ApiController.php
│   ├── models/
│   │   ├── User.php
│   │   ├── Student.php
│   │   ├── ClassModel.php
│   │   ├── Subject.php
│   │   ├── Grade.php
│   │   ├── Period.php
│   │   ├── Log.php
│   │   └── Setting.php
│   ├── views/
│   │   ├── admin/
│   │   ├── teacher/
│   │   ├── auth/
│   │   └── layouts/
│   └── helpers/
│       ├── functions.php
│       ├── Mailer.php
│       └── Telegram.php
├── config/
│   └── config.php
├── storage/
│   └── logs/
├── database.sql
└── README.md

1. DATABASE.SQL
sqlCREATE DATABASE IF NOT EXISTS student_management CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE student_management;

-- Users table
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(100) UNIQUE NOT NULL,
    email VARCHAR(150) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    role ENUM('admin', 'teacher') NOT NULL,
    status ENUM('active', 'pending', 'suspended', 'rejected') DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_email (email),
    INDEX idx_role (role),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Teachers profiles
CREATE TABLE teachers_profiles (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    phone VARCHAR(20),
    address TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Students table
CREATE TABLE students (
    id INT AUTO_INCREMENT PRIMARY KEY,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    gender ENUM('male', 'female', 'other') NOT NULL,
    class_id INT,
    student_number VARCHAR(50) UNIQUE,
    birth_date DATE,
    parent_phone VARCHAR(20),
    address TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_class_id (class_id),
    INDEX idx_student_number (student_number)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Classes table
CREATE TABLE classes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Subjects table
CREATE TABLE subjects (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    code VARCHAR(20) UNIQUE,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_code (code)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Periods table
CREATE TABLE periods (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    start_date DATE,
    end_date DATE,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_is_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Teacher subject assignments
CREATE TABLE teacher_subjects (
    id INT AUTO_INCREMENT PRIMARY KEY,
    teacher_id INT NOT NULL,
    subject_id INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (teacher_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (subject_id) REFERENCES subjects(id) ON DELETE CASCADE,
    UNIQUE KEY unique_assignment (teacher_id, subject_id),
    INDEX idx_teacher_id (teacher_id),
    INDEX idx_subject_id (subject_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Grades table
CREATE TABLE grades (
    id INT AUTO_INCREMENT PRIMARY KEY,
    student_id INT NOT NULL,
    subject_id INT NOT NULL,
    period_id INT NOT NULL,
    grade DECIMAL(5,2) NOT NULL,
    teacher_id INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (student_id) REFERENCES students(id) ON DELETE CASCADE,
    FOREIGN KEY (subject_id) REFERENCES subjects(id) ON DELETE CASCADE,
    FOREIGN KEY (period_id) REFERENCES periods(id) ON DELETE CASCADE,
    FOREIGN KEY (teacher_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY unique_grade (student_id, subject_id, period_id),
    INDEX idx_student_id (student_id),
    INDEX idx_subject_id (subject_id),
    INDEX idx_period_id (period_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Grade revisions
CREATE TABLE grade_revisions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    grade_id INT NOT NULL,
    old_grade DECIMAL(5,2),
    new_grade DECIMAL(5,2) NOT NULL,
    changed_by INT NOT NULL,
    changed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (grade_id) REFERENCES grades(id) ON DELETE CASCADE,
    FOREIGN KEY (changed_by) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_grade_id (grade_id),
    INDEX idx_changed_at (changed_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Behavior notes
CREATE TABLE behavior_notes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    student_id INT NOT NULL,
    teacher_id INT NOT NULL,
    note TEXT NOT NULL,
    note_date DATE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (student_id) REFERENCES students(id) ON DELETE CASCADE,
    FOREIGN KEY (teacher_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_student_id (student_id),
    INDEX idx_note_date (note_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Logs table
CREATE TABLE logs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    action VARCHAR(100) NOT NULL,
    target_table VARCHAR(50),
    target_id INT,
    old_value TEXT,
    new_value TEXT,
    ip_address VARCHAR(45),
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL,
    INDEX idx_user_id (user_id),
    INDEX idx_action (action),
    INDEX idx_target_table (target_table),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Error logs
CREATE TABLE error_logs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    error_message TEXT NOT NULL,
    error_file VARCHAR(255),
    error_line INT,
    stack_trace TEXT,
    user_id INT,
    ip_address VARCHAR(45),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- User sessions
CREATE TABLE user_sessions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    session_token VARCHAR(255) NOT NULL,
    ip_address VARCHAR(45),
    user_agent TEXT,
    login_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    logout_at TIMESTAMP NULL,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_session_token (session_token)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Settings table
CREATE TABLE settings (
    id INT AUTO_INCREMENT PRIMARY KEY,
    setting_key VARCHAR(100) UNIQUE NOT NULL,
    setting_value TEXT,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_setting_key (setting_key)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Insert default admin
INSERT INTO users (username, email, password, role, status) VALUES 
('admin', 'admin@example.com', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'admin', 'active');
-- Password: password

-- Insert default settings
INSERT INTO settings (setting_key, setting_value) VALUES
('smtp_host', ''),
('smtp_port', '587'),
('smtp_username', ''),
('smtp_password', ''),
('smtp_encryption', 'tls'),
('smtp_from_email', ''),
('smtp_from_name', ''),
('telegram_bot_token', ''),
('telegram_chat_ids', '[]'),
('notification_email_enabled', '0'),
('notification_telegram_enabled', '0');

2. CONFIG/CONFIG.PHP
php<?php
// Database configuration
define('DB_HOST', 'localhost');
define('DB_NAME', 'student_management');
define('DB_USER', 'root');
define('DB_PASS', '');
define('DB_CHARSET', 'utf8mb4');

// Application configuration
define('APP_NAME', 'Öğrenci Not Yönetim Sistemi');
define('BASE_URL', 'http://localhost/student_management/public');
define('UPLOAD_PATH', __DIR__ . '/../storage/uploads/');
define('LOG_PATH', __DIR__ . '/../storage/logs/');

// Session configuration
define('SESSION_LIFETIME', 7200); // 2 hours

// Timezone
date_default_timezone_set('Europe/Istanbul');

// Error reporting (production için kapatılmalı)
error_reporting(E_ALL);
ini_set('display_errors', 1);

// Autoload
spl_autoload_register(function($class) {
    $file = __DIR__ . '/../app/' . str_replace('\\', '/', $class) . '.php';
    if (file_exists($file)) {
        require_once $file;
    }
});

// Start session
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

// CSRF Token
if (!isset($_SESSION['csrf_token'])) {
    $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
}

3. PUBLIC/INDEX.PHP
php<?php
require_once __DIR__ . '/../config/config.php';
require_once __DIR__ . '/../app/helpers/functions.php';

use app\core\App;

$app = new App();
$app->run();

4. APP/CORE/APP.PHP
php<?php
namespace app\core;

class App {
    protected $controller = 'AuthController';
    protected $method = 'login';
    protected $params = [];

    public function __construct() {
        $url = $this->parseUrl();
        
        // Check if user is logged in
        if (!isset($_SESSION['user_id']) && (!isset($url[0]) || !in_array($url[0], ['auth', 'register']))) {
            header('Location: ' . BASE_URL . '/auth/login');
            exit;
        }

        // Route controller
        if (isset($url[0])) {
            $controllerName = ucfirst($url[0]) . 'Controller';
            $controllerFile = __DIR__ . '/../controllers/' . $controllerName . '.php';
            
            if (file_exists($controllerFile)) {
                $this->controller = $controllerName;
                unset($url[0]);
            }
        }

        require_once __DIR__ . '/../controllers/' . $this->controller . '.php';
        $controllerClass = 'app\\controllers\\' . $this->controller;
        $this->controller = new $controllerClass;

        // Check method
        if (isset($url[1])) {
            if (method_exists($this->controller, $url[1])) {
                $this->method = $url[1];
                unset($url[1]);
            }
        }

        $this->params = $url ? array_values($url) : [];
    }

    public function run() {
        call_user_func_array([$this->controller, $this->method], $this->params);
    }

    protected function parseUrl() {
        if (isset($_GET['url'])) {
            return explode('/', filter_var(rtrim($_GET['url'], '/'), FILTER_SANITIZE_URL));
        }
        return [];
    }
}

5. APP/CORE/DATABASE.PHP
php<?php
namespace app\core;

use PDO;
use PDOException;

class Database {
    private static $instance = null;
    private $connection;

    private function __construct() {
        try {
            $dsn = "mysql:host=" . DB_HOST . ";dbname=" . DB_NAME . ";charset=" . DB_CHARSET;
            $this->connection = new PDO($dsn, DB_USER, DB_PASS, [
                PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
                PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
                PDO::ATTR_EMULATE_PREPARES => false,
            ]);
        } catch (PDOException $e) {
            $this->logError($e);
            die('Veritabanı bağlantı hatası');
        }
    }

    public static function getInstance() {
        if (self::$instance === null) {
            self::$instance = new self();
        }
        return self::$instance;
    }

    public function getConnection() {
        return $this->connection;
    }

    private function logError($e) {
        error_log(date('Y-m-d H:i:s') . ' - ' . $e->getMessage() . PHP_EOL, 3, LOG_PATH . 'db_errors.log');
    }
}

6. APP/CORE/CONTROLLER.PHP
php<?php
namespace app\core;

class Controller {
    protected function view($view, $data = []) {
        extract($data);
        require_once __DIR__ . '/../views/' . $view . '.php';
    }

    protected function model($model) {
        require_once __DIR__ . '/../models/' . $model . '.php';
        $modelClass = 'app\\models\\' . $model;
        return new $modelClass();
    }

    protected function redirect($url) {
        header('Location: ' . BASE_URL . '/' . $url);
        exit;
    }

    protected function json($data, $statusCode = 200) {
        http_response_code($statusCode);
        header('Content-Type: application/json');
        echo json_encode($data);
        exit;
    }

    protected function checkAuth($requiredRole = null) {
        if (!isset($_SESSION['user_id'])) {
            $this->redirect('auth/login');
        }

        if ($requiredRole && $_SESSION['role'] !== $requiredRole) {
            $this->redirect('auth/unauthorized');
        }
    }

    protected function validateCSRF() {
        if (!isset($_POST['csrf_token']) || $_POST['csrf_token'] !== $_SESSION['csrf_token']) {
            die('CSRF token validation failed');
        }
    }
}

7. APP/CORE/MODEL.PHP
php<?php
namespace app\core;

use PDO;

class Model {
    protected $db;
    protected $table;

    public function __construct() {
        $this->db = Database::getInstance()->getConnection();
    }

    public function findAll() {
        $stmt = $this->db->query("SELECT * FROM {$this->table}");
        return $stmt->fetchAll();
    }

    public function findById($id) {
        $stmt = $this->db->prepare("SELECT * FROM {$this->table} WHERE id = ?");
        $stmt->execute([$id]);
        return $stmt->fetch();
    }

    public function create($data) {
        $fields = array_keys($data);
        $values = array_values($data);
        $placeholders = str_repeat('?,', count($fields) - 1) . '?';
        
        $sql = "INSERT INTO {$this->table} (" . implode(',', $fields) . ") VALUES ({$placeholders})";
        $stmt = $this->db->prepare($sql);
        $stmt->execute($values);
        
        return $this->db->lastInsertId();
    }

    public function update($id, $data) {
        $fields = [];
        $values = [];
        
        foreach ($data as $key => $value) {
            $fields[] = "{$key} = ?";
            $values[] = $value;
        }
        
        $values[] = $id;
        $sql = "UPDATE {$this->table} SET " . implode(', ', $fields) . " WHERE id = ?";
        $stmt = $this->db->prepare($sql);
        
        return $stmt->execute($values);
    }

    public function delete($id) {
        $stmt = $this->db->prepare("DELETE FROM {$this->table} WHERE id = ?");
        return $stmt->execute([$id]);
    }
}

8. APP/HELPERS/FUNCTIONS.PHP
php<?php

function sanitize($data) {
    if (is_array($data)) {
        return array_map('sanitize', $data);
    }
    return htmlspecialchars(strip_tags(trim($data)), ENT_QUOTES, 'UTF-8');
}

function generateCSRFToken() {
    if (!isset($_SESSION['csrf_token'])) {
        $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
    }
    return $_SESSION['csrf_token'];
}

function validateCSRF($token) {
    return isset($_SESSION['csrf_token']) && hash_equals($_SESSION['csrf_token'], $token);
}

function isLoggedIn() {
    return isset($_SESSION['user_id']);
}

function getCurrentUser() {
    if (!isLoggedIn()) {
        return null;
    }
    return [
        'id' => $_SESSION['user_id'],
        'username' => $_SESSION['username'] ?? '',
        'email' => $_SESSION['email'] ?? '',
        'role' => $_SESSION['role'] ?? ''
    ];
}

function isAdmin() {
    return isset($_SESSION['role']) && $_SESSION['role'] === 'admin';
}

function isTeacher() {
    return isset($_SESSION['role']) && $_SESSION['role'] === 'teacher';
}

function getClientIP() {
    if (!empty($_SERVER['HTTP_CLIENT_IP'])) {
        return $_SERVER['HTTP_CLIENT_IP'];
    } elseif (!empty($_SERVER['HTTP_X_FORWARDED_FOR'])) {
        return $_SERVER['HTTP_X_FORWARDED_FOR'];
    }
    return $_SERVER['REMOTE_ADDR'] ?? 'unknown';
}

function getUserAgent() {
    return $_SERVER['HTTP_USER_AGENT'] ?? 'unknown';
}

function flashMessage($type, $message) {
    $_SESSION['flash'] = [
        'type' => $type,
        'message' => $message
    ];
}

function getFlashMessage() {
    if (isset($_SESSION['flash'])) {
        $flash = $_SESSION['flash'];
        unset($_SESSION['flash']);
        return $flash;
    }
    return null;
}

function formatDate($date, $format = 'd.m.Y') {
    return date($format, strtotime($date));
}

function formatDateTime($datetime, $format = 'd.m.Y H:i') {
    return date($format, strtotime($datetime));
}

function generateStudentNumber() {
    return 'STU' . date('Y') . str_pad(rand(1, 9999), 4, '0', STR_PAD_LEFT);
}

function uploadFile($file, $allowedTypes = ['jpg', 'jpeg', 'png', 'pdf']) {
    $uploadDir = UPLOAD_PATH;
    if (!file_exists($uploadDir)) {
        mkdir($uploadDir, 0755, true);
    }

    $ext = strtolower(pathinfo($file['name'], PATHINFO_EXTENSION));
    if (!in_array($ext, $allowedTypes)) {
        return ['success' => false, 'message' => 'Geçersiz dosya türü'];
    }

    $filename = uniqid() . '.' . $ext;
    $filepath = $uploadDir . $filename;

    if (move_uploaded_file($file['tmp_name'], $filepath)) {
        return ['success' => true, 'filename' => $filename];
    }

    return ['success' => false, 'message' => 'Dosya yüklenemedi'];
}

9. APP/HELPERS/MAILER.PHP
php<?php
namespace app\helpers;

use PHPMailer\PHPMailer\PHPMailer;
use PHPMailer\PHPMailer\Exception;

require_once __DIR__ . '/../../vendor/phpmailer/phpmailer/src/Exception.php';
require_once __DIR__ . '/../../vendor/phpmailer/phpmailer/src/PHPMailer.php';
require_once __DIR__ . '/../../vendor/phpmailer/phpmailer/src/SMTP.php';

class Mailer {
    private $mailer;
    private $settings;

    public function __construct($settings) {
        $this->settings = $settings;
        $this->mailer = new PHPMailer(true);
        $this->configure();
    }

    private function configure() {
        try {
            $this->mailer->isSMTP();
            $this->mailer->Host = $this->settings['smtp_host'];
            $this->mailer->SMTPAuth = true;
            $this->mailer->Username = $this->settings['smtp_username'];
            $this->mailer->Password = $this->settings['smtp_password'];
            $this->mailer->SMTPSecure = $this->settings['smtp_encryption'];
            $this->mailer->Port = $this->settings['smtp_port'];
            $this->mailer->CharSet = 'UTF-8';
            $this->mailer->setFrom($this->settings['smtp_from_email'], $this->settings['smtp_from_name']);
        } catch (Exception $e) {
            error_log('Mailer configuration error: ' . $e->getMessage());
        }
    }

    public function send($to, $subject, $body, $isHTML = true) {
        try {
            $this->mailer->addAddress($to);
            $this->mailer->isHTML($isHTML);
            $this->mailer->Subject = $subject;
            $this->mailer->Body = $body;

            return $this->mailer->send();
        } catch (Exception $e) {
            error_log('Mail send error: ' . $this->mailer->ErrorInfo);
            return false;
        }
    }

    public function sendBulk($recipients, $subject, $body) {
        $results = [];
        foreach ($recipients as $email) {
            $results[$email] = $this->send($email, $subject, $body);
            $this->mailer->clearAddresses();
        }
        return $results;
    }
}

10. APP/HELPERS/TELEGRAM.PHP
php<?php
namespace app\helpers;

class Telegram {
    private $botToken;
    private $chatIds;

    public function __construct($botToken, $chatIds = []) {
        $this->botToken = $botToken;
        $this->chatIds = is_array($chatIds) ? $chatIds : json_decode($chatIds, true) ?? [];
    }

    public function sendMessage($message, $parseMode = 'HTML') {
        if (empty($this->botToken) || empty($this->chatIds)) {
            return false;
        }

        $results = [];
        foreach ($this->chatIds as $chatId) {
            $url = "https://api.telegram.org/bot{$this->botToken}/sendMessage";
            $data = [
                'chat_id' => $chatId,
                'text' => $message,
                'parse_mode' => $parseMode
            ];

            $ch = curl_init($url);
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
            curl_setopt($ch, CURLOPT_POST, true);
            curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($data));
            
            $response = curl_exec($ch);
            $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
            curl_close($ch);

            $results[$chatId] = ($httpCode === 200);
        }

        return in_array(true, $results);
    }

    public function sendNotification($title, $message) {
        $text = "<b>{$title}</b>\n\n{$message}\n\n" . date('d.m.Y H:i:s');
        return $this->sendMessage($text);
    }
}

Karakter sınırı nedeniyle devam edeceğim. Modelleri, controller'ları ve view dosyalarını sonraki mesajlarda paylaşacağım.Kdevam etKdevam et11. APP/MODELS/USER.PHP
php<?php
namespace app\models;

use app\core\Model;
use PDO;

class User extends Model {
    protected $table = 'users';

    public function findByEmail($email) {
        $stmt = $this->db->prepare("SELECT * FROM {$this->table} WHERE email = ?");
        $stmt->execute([$email]);
        return $stmt->fetch();
    }

    public function findByUsername($username) {
        $stmt = $this->db->prepare("SELECT * FROM {$this->table} WHERE username = ?");
        $stmt->execute([$username]);
        return $stmt->fetch();
    }

    public function register($data) {
        $hashedPassword = password_hash($data['password'], PASSWORD_DEFAULT);
        
        $userId = $this->create([
            'username' => $data['username'],
            'email' => $data['email'],
            'password' => $hashedPassword,
            'role' => $data['role'] ?? 'teacher',
            'status' => 'pending'
        ]);

        if ($userId && isset($data['role']) && $data['role'] === 'teacher') {
            $stmt = $this->db->prepare("INSERT INTO teachers_profiles (user_id, first_name, last_name, phone, address) VALUES (?, ?, ?, ?, ?)");
            $stmt->execute([
                $userId,
                $data['first_name'] ?? '',
                $data['last_name'] ?? '',
                $data['phone'] ?? '',
                $data['address'] ?? ''
            ]);
        }

        return $userId;
    }

    public function authenticate($email, $password) {
        $user = $this->findByEmail($email);
        
        if ($user && password_verify($password, $user['password'])) {
            if ($user['status'] !== 'active') {
                return ['success' => false, 'message' => 'Hesabınız aktif değil'];
            }
            return ['success' => true, 'user' => $user];
        }
        
        return ['success' => false, 'message' => 'Geçersiz email veya şifre'];
    }

    public function getPendingTeachers() {
        $stmt = $this->db->query("
            SELECT u.*, tp.first_name, tp.last_name, tp.phone 
            FROM users u
            LEFT JOIN teachers_profiles tp ON u.id = tp.user_id
            WHERE u.role = 'teacher' AND u.status = 'pending'
            ORDER BY u.created_at DESC
        ");
        return $stmt->fetchAll();
    }

    public function getAllTeachers() {
        $stmt = $this->db->query("
            SELECT u.*, tp.first_name, tp.last_name, tp.phone 
            FROM users u
            LEFT JOIN teachers_profiles tp ON u.id = tp.user_id
            WHERE u.role = 'teacher'
            ORDER BY u.created_at DESC
        ");
        return $stmt->fetchAll();
    }

    public function updateStatus($userId, $status) {
        return $this->update($userId, ['status' => $status]);
    }

    public function getTeacherProfile($userId) {
        $stmt = $this->db->prepare("
            SELECT u.*, tp.first_name, tp.last_name, tp.phone, tp.address 
            FROM users u
            LEFT JOIN teachers_profiles tp ON u.id = tp.user_id
            WHERE u.id = ?
        ");
        $stmt->execute([$userId]);
        return $stmt->fetch();
    }

    public function updateProfile($userId, $data) {
        $this->update($userId, [
            'username' => $data['username'],
            'email' => $data['email']
        ]);

        $stmt = $this->db->prepare("
            UPDATE teachers_profiles 
            SET first_name = ?, last_name = ?, phone = ?, address = ?
            WHERE user_id = ?
        ");
        return $stmt->execute([
            $data['first_name'],
            $data['last_name'],
            $data['phone'] ?? '',
            $data['address'] ?? '',
            $userId
        ]);
    }

    public function changePassword($userId, $newPassword) {
        $hashedPassword = password_hash($newPassword, PASSWORD_DEFAULT);
        return $this->update($userId, ['password' => $hashedPassword]);
    }

    public function getTeacherSubjects($teacherId) {
        $stmt = $this->db->prepare("
            SELECT s.* 
            FROM subjects s
            INNER JOIN teacher_subjects ts ON s.id = ts.subject_id
            WHERE ts.teacher_id = ?
        ");
        $stmt->execute([$teacherId]);
        return $stmt->fetchAll();
    }

    public function assignSubject($teacherId, $subjectId) {
        $stmt = $this->db->prepare("
            INSERT IGNORE INTO teacher_subjects (teacher_id, subject_id) 
            VALUES (?, ?)
        ");
        return $stmt->execute([$teacherId, $subjectId]);
    }

    public function removeSubject($teacherId, $subjectId) {
        $stmt = $this->db->prepare("
            DELETE FROM teacher_subjects 
            WHERE teacher_id = ? AND subject_id = ?
        ");
        return $stmt->execute([$teacherId, $subjectId]);
    }
}

12. APP/MODELS/STUDENT.PHP
php<?php
namespace app\models;

use app\core\Model;
use PDO;

class Student extends Model {
    protected $table = 'students';

    public function getAllWithClass() {
        $stmt = $this->db->query("
            SELECT s.*, c.name as class_name 
            FROM students s
            LEFT JOIN classes c ON s.class_id = c.id
            ORDER BY s.first_name, s.last_name
        ");
        return $stmt->fetchAll();
    }

    public function getByClass($classId) {
        $stmt = $this->db->prepare("
            SELECT s.*, c.name as class_name 
            FROM students s
            LEFT JOIN classes c ON s.class_id = c.id
            WHERE s.class_id = ?
            ORDER BY s.first_name, s.last_name
        ");
        $stmt->execute([$classId]);
        return $stmt->fetchAll();
    }

    public function search($filters) {
        $sql = "SELECT s.*, c.name as class_name FROM students s LEFT JOIN classes c ON s.class_id = c.id WHERE 1=1";
        $params = [];

        if (!empty($filters['class_id'])) {
            $sql .= " AND s.class_id = ?";
            $params[] = $filters['class_id'];
        }

        if (!empty($filters['gender'])) {
            $sql .= " AND s.gender = ?";
            $params[] = $filters['gender'];
        }

        if (!empty($filters['search'])) {
            $sql .= " AND (s.first_name LIKE ? OR s.last_name LIKE ? OR s.student_number LIKE ?)";
            $searchTerm = '%' . $filters['search'] . '%';
            $params[] = $searchTerm;
            $params[] = $searchTerm;
            $params[] = $searchTerm;
        }

        $sql .= " ORDER BY s.first_name, s.last_name";

        $stmt = $this->db->prepare($sql);
        $stmt->execute($params);
        return $stmt->fetchAll();
    }

    public function createStudent($data) {
        if (empty($data['student_number'])) {
            $data['student_number'] = generateStudentNumber();
        }

        return $this->create([
            'first_name' => $data['first_name'],
            'last_name' => $data['last_name'],
            'gender' => $data['gender'],
            'class_id' => $data['class_id'] ?? null,
            'student_number' => $data['student_number'],
            'birth_date' => $data['birth_date'] ?? null,
            'parent_phone' => $data['parent_phone'] ?? null,
            'address' => $data['address'] ?? null
        ]);
    }

    public function updateStudent($id, $data) {
        return $this->update($id, [
            'first_name' => $data['first_name'],
            'last_name' => $data['last_name'],
            'gender' => $data['gender'],
            'class_id' => $data['class_id'] ?? null,
            'student_number' => $data['student_number'],
            'birth_date' => $data['birth_date'] ?? null,
            'parent_phone' => $data['parent_phone'] ?? null,
            'address' => $data['address'] ?? null
        ]);
    }

    public function getGrades($studentId) {
        $stmt = $this->db->prepare("
            SELECT g.*, s.name as subject_name, p.name as period_name,
                   u.username as teacher_name
            FROM grades g
            INNER JOIN subjects s ON g.subject_id = s.id
            INNER JOIN periods p ON g.period_id = p.id
            INNER JOIN users u ON g.teacher_id = u.id
            WHERE g.student_id = ?
            ORDER BY p.id, s.name
        ");
        $stmt->execute([$studentId]);
        return $stmt->fetchAll();
    }

    public function getGradesGrouped($studentId) {
        $grades = $this->getGrades($studentId);
        $grouped = [];

        foreach ($grades as $grade) {
            $periodName = $grade['period_name'];
            if (!isset($grouped[$periodName])) {
                $grouped[$periodName] = [];
            }
            $grouped[$periodName][] = $grade;
        }

        return $grouped;
    }

    public function getAverageBySubject($studentId, $subjectId) {
        $stmt = $this->db->prepare("
            SELECT AVG(grade) as average 
            FROM grades 
            WHERE student_id = ? AND subject_id = ?
        ");
        $stmt->execute([$studentId, $subjectId]);
        $result = $stmt->fetch();
        return $result ? round($result['average'], 2) : 0;
    }

    public function getOverallAverage($studentId) {
        $stmt = $this->db->prepare("
            SELECT AVG(grade) as average 
            FROM grades 
            WHERE student_id = ?
        ");
        $stmt->execute([$studentId]);
        $result = $stmt->fetch();
        return $result ? round($result['average'], 2) : 0;
    }

    public function getBehaviorNotes($studentId) {
        $stmt = $this->db->prepare("
            SELECT bn.*, u.username as teacher_name, tp.first_name, tp.last_name
            FROM behavior_notes bn
            INNER JOIN users u ON bn.teacher_id = u.id
            LEFT JOIN teachers_profiles tp ON u.id = tp.user_id
            WHERE bn.student_id = ?
            ORDER BY bn.note_date DESC
        ");
        $stmt->execute([$studentId]);
        return $stmt->fetchAll();
    }

    public function exportGradesJSON($studentId) {
        $student = $this->findById($studentId);
        $grades = $this->getGrades($studentId);

        $export = [
            'student' => [
                'first_name' => $student['first_name'],
                'last_name' => $student['last_name'],
                'student_number' => $student['student_number']
            ],
            'grades' => []
        ];

        foreach ($grades as $grade) {
            $export['grades'][] = [
                'subject' => $grade['subject_name'],
                'period' => $grade['period_name'],
                'grade' => $grade['grade'],
                'teacher' => $grade['teacher_name'],
                'date' => $grade['created_at']
            ];
        }

        return json_encode($export, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE);
    }

    public function bulkCreate($students) {
        $success = 0;
        $errors = [];

        foreach ($students as $index => $studentData) {
            try {
                $this->createStudent($studentData);
                $success++;
            } catch (\Exception $e) {
                $errors[] = "Satır " . ($index + 1) . ": " . $e->getMessage();
            }
        }

        return [
            'success' => $success,
            'errors' => $errors
        ];
    }
}

13. APP/MODELS/CLASSMODEL.PHP
php<?php
namespace app\models;

use app\core\Model;
use PDO;

class ClassModel extends Model {
    protected $table = 'classes';

    public function getAllWithStudentCount() {
        $stmt = $this->db->query("
            SELECT c.*, COUNT(s.id) as student_count
            FROM classes c
            LEFT JOIN students s ON c.id = s.class_id
            GROUP BY c.id
            ORDER BY c.name
        ");
        return $stmt->fetchAll();
    }

    public function getStudents($classId) {
        $stmt = $this->db->prepare("
            SELECT * FROM students 
            WHERE class_id = ? 
            ORDER BY first_name, last_name
        ");
        $stmt->execute([$classId]);
        return $stmt->fetchAll();
    }

    public function getClassAverage($classId, $subjectId = null, $periodId = null) {
        $sql = "
            SELECT AVG(g.grade) as average 
            FROM grades g
            INNER JOIN students s ON g.student_id = s.id
            WHERE s.class_id = ?
        ";
        $params = [$classId];

        if ($subjectId) {
            $sql .= " AND g.subject_id = ?";
            $params[] = $subjectId;
        }

        if ($periodId) {
            $sql .= " AND g.period_id = ?";
            $params[] = $periodId;
        }

        $stmt = $this->db->prepare($sql);
        $stmt->execute($params);
        $result = $stmt->fetch();
        return $result ? round($result['average'], 2) : 0;
    }

    public function assignStudent($classId, $studentId) {
        $stmt = $this->db->prepare("UPDATE students SET class_id = ? WHERE id = ?");
        return $stmt->execute([$classId, $studentId]);
    }

    public function removeStudent($studentId) {
        $stmt = $this->db->prepare("UPDATE students SET class_id = NULL WHERE id = ?");
        return $stmt->execute([$studentId]);
    }

    public function getClassGrades($classId, $subjectId, $periodId) {
        $stmt = $this->db->prepare("
            SELECT s.id, s.first_name, s.last_name, g.grade, g.id as grade_id
            FROM students s
            LEFT JOIN grades g ON s.id = g.student_id 
                AND g.subject_id = ? 
                AND g.period_id = ?
            WHERE s.class_id = ?
            ORDER BY s.first_name, s.last_name
        ");
        $stmt->execute([$subjectId, $periodId, $classId]);
        return $stmt->fetchAll();
    }
}

14. APP/MODELS/SUBJECT.PHP
php<?php
namespace app\models;

use app\core\Model;
use PDO;

class Subject extends Model {
    protected $table = 'subjects';

    public function getAllWithTeachers() {
        $stmt = $this->db->query("
            SELECT s.*, 
                   GROUP_CONCAT(CONCAT(tp.first_name, ' ', tp.last_name) SEPARATOR ', ') as teachers
            FROM subjects s
            LEFT JOIN teacher_subjects ts ON s.id = ts.subject_id
            LEFT JOIN teachers_profiles tp ON ts.teacher_id = tp.user_id
            GROUP BY s.id
            ORDER BY s.name
        ");
        return $stmt->fetchAll();
    }

    public function getTeachers($subjectId) {
        $stmt = $this->db->prepare("
            SELECT u.id, u.username, tp.first_name, tp.last_name
            FROM users u
            INNER JOIN teacher_subjects ts ON u.id = ts.teacher_id
            LEFT JOIN teachers_profiles tp ON u.id = tp.user_id
            WHERE ts.subject_id = ?
        ");
        $stmt->execute([$subjectId]);
        return $stmt->fetchAll();
    }

    public function createSubject($data) {
        return $this->create([
            'name' => $data['name'],
            'code' => $data['code'] ?? null,
            'description' => $data['description'] ?? null
        ]);
    }

    public function updateSubject($id, $data) {
        return $this->update($id, [
            'name' => $data['name'],
            'code' => $data['code'] ?? null,
            'description' => $data['description'] ?? null
        ]);
    }

    public function hasGrades($subjectId) {
        $stmt = $this->db->prepare("SELECT COUNT(*) as count FROM grades WHERE subject_id = ?");
        $stmt->execute([$subjectId]);
        $result = $stmt->fetch();
        return $result['count'] > 0;
    }
}

15. APP/MODELS/GRADE.PHP
php<?php
namespace app\models;

use app\core\Model;
use PDO;

class Grade extends Model {
    protected $table = 'grades';

    public function addGrade($data) {
        // Check if grade already exists
        $stmt = $this->db->prepare("
            SELECT id, grade FROM grades 
            WHERE student_id = ? AND subject_id = ? AND period_id = ?
        ");
        $stmt->execute([$data['student_id'], $data['subject_id'], $data['period_id']]);
        $existing = $stmt->fetch();

        if ($existing) {
            // Update existing grade and create revision
            $this->createRevision($existing['id'], $existing['grade'], $data['grade'], $data['teacher_id']);
            
            $stmt = $this->db->prepare("
                UPDATE grades 
                SET grade = ?, teacher_id = ?, updated_at = NOW() 
                WHERE id = ?
            ");
            $stmt->execute([$data['grade'], $data['teacher_id'], $existing['id']]);
            return $existing['id'];
        } else {
            // Create new grade
            return $this->create([
                'student_id' => $data['student_id'],
                'subject_id' => $data['subject_id'],
                'period_id' => $data['period_id'],
                'grade' => $data['grade'],
                'teacher_id' => $data['teacher_id']
            ]);
        }
    }

    public function updateGrade($id, $newGrade, $teacherId) {
        $stmt = $this->db->prepare("SELECT grade FROM grades WHERE id = ?");
        $stmt->execute([$id]);
        $current = $stmt->fetch();

        if ($current) {
            $this->createRevision($id, $current['grade'], $newGrade, $teacherId);
            
            $stmt = $this->db->prepare("
                UPDATE grades 
                SET grade = ?, teacher_id = ?, updated_at = NOW() 
                WHERE id = ?
            ");
            return $stmt->execute([$newGrade, $teacherId, $id]);
        }

        return false;
    }

    private function createRevision($gradeId, $oldGrade, $newGrade, $changedBy) {
        $stmt = $this->db->prepare("
            INSERT INTO grade_revisions (grade_id, old_grade, new_grade, changed_by) 
            VALUES (?, ?, ?, ?)
        ");
        return $stmt->execute([$gradeId, $oldGrade, $newGrade, $changedBy]);
    }

    public function getRevisions($gradeId) {
        $stmt = $this->db->prepare("
            SELECT gr.*, u.username, tp.first_name, tp.last_name
            FROM grade_revisions gr
            INNER JOIN users u ON gr.changed_by = u.id
            LEFT JOIN teachers_profiles tp ON u.id = tp.user_id
            WHERE gr.grade_id = ?
            ORDER BY gr.changed_at DESC
        ");
        $stmt->execute([$gradeId]);
        return $stmt->fetchAll();
    }

    public function bulkInsert($grades, $teacherId) {
        $success = 0;
        $errors = [];

        foreach ($grades as $gradeData) {
            try {
                $gradeData['teacher_id'] = $teacherId;
                $this->addGrade($gradeData);
                $success++;
            } catch (\Exception $e) {
                $errors[] = $e->getMessage();
            }
        }

        return [
            'success' => $success,
            'errors' => $errors
        ];
    }

    public function getRecentGrades($teacherId = null, $limit = 10) {
        $sql = "
            SELECT g.*, s.first_name, s.last_name, sub.name as subject_name, 
                   p.name as period_name, u.username as teacher_name
            FROM grades g
            INNER JOIN students s ON g.student_id = s.id
            INNER JOIN subjects sub ON g.subject_id = sub.id
            INNER JOIN periods p ON g.period_id = p.id
            INNER JOIN users u ON g.teacher_id = u.id
        ";

        if ($teacherId) {
            $sql .= " WHERE g.teacher_id = ?";
        }

        $sql .= " ORDER BY g.created_at DESC LIMIT ?";

        $stmt = $this->db->prepare($sql);
        
        if ($teacherId) {
            $stmt->execute([$teacherId, $limit]);
        } else {
            $stmt->execute([$limit]);
        }

        return $stmt->fetchAll();
    }

    public function getMissingGrades($classId, $subjectId, $periodId) {
        $stmt = $this->db->prepare("
            SELECT s.id, s.first_name, s.last_name
            FROM students s
            WHERE s.class_id = ?
            AND s.id NOT IN (
                SELECT student_id FROM grades 
                WHERE subject_id = ? AND period_id = ?
            )
            ORDER BY s.first_name, s.last_name
        ");
        $stmt->execute([$classId, $subjectId, $periodId]);
        return $stmt->fetchAll();
    }
}

16. APP/MODELS/PERIOD.PHP
php<?php
namespace app\models;

use app\core\Model;
use PDO;

class Period extends Model {
    protected $table = 'periods';

    public function getActive() {
        $stmt = $this->db->query("SELECT * FROM periods WHERE is_active = 1 ORDER BY start_date DESC");
        return $stmt->fetchAll();
    }

    public function createPeriod($data) {
        return $this->create([
            'name' => $data['name'],
            'start_date' => $data['start_date'] ?? null,
            'end_date' => $data['end_date'] ?? null,
            'is_active' => $data['is_active'] ?? 1
        ]);
    }

    public function updatePeriod($id, $data) {
        return $this->update($id, [
            'name' => $data['name'],
            'start_date' => $data['start_date'] ?? null,
            'end_date' => $data['end_date'] ?? null,
            'is_active' => $data['is_active'] ?? 1
        ]);
    }

    public function toggleActive($id) {
        $stmt = $this->db->prepare("UPDATE periods SET is_active = NOT is_active WHERE id = ?");
        return $stmt->execute([$id]);
    }
}

17. APP/MODELS/LOG.PHP
php<?php
namespace app\models;

use app\core\Model;
use PDO;

class Log extends Model {
    protected $table = 'logs';

    public function createLog($data) {
        return $this->create([
            'user_id' => $data['user_id'] ?? null,
            'action' => $data['action'],
            'target_table' => $data['target_table'] ?? null,
            'target_id' => $data['target_id'] ?? null,
            'old_value' => isset($data['old_value']) ? json_encode($data['old_value'], JSON_UNESCAPED_UNICODE) : null,
            'new_value' => isset($data['new_value']) ? json_encode($data['new_value'], JSON_UNESCAPED_UNICODE) : null,
            'ip_address' => getClientIP(),
            'user_agent' => getUserAgent()
        ]);
    }

    public function getFiltered($filters = []) {
        $sql = "
            SELECT l.*, u.username, u.email
            FROM logs l
            LEFT JOIN users u ON l.user_id = u.id
            WHERE 1=1
        ";
        $params = [];

        if (!empty($filters['user_id'])) {
            $sql .= " AND l.user_id = ?";
            $params[] = $filters['user_id'];
        }

        if (!empty($filters['action'])) {
            $sql .= " AND l.action LIKE ?";
            $params[] = '%' . $filters['action'] . '%';
        }

        if (!empty($filters['target_table'])) {
            $sql .= " AND l.target_table = ?";
            $params[] = $filters['target_table'];
        }

        if (!empty($filters['date_from'])) {
            $sql .= " AND DATE(l.created_at) >= ?";
            $params[] = $filters['date_from'];
        }

        if (!empty($filters['date_to'])) {
            $sql .= " AND DATE(l.created_at) <= ?";
            $params[] = $filters['date_to'];
        }

        $sql .= " ORDER BY l.created_at DESC LIMIT 1000";

        $stmt = $this->db->prepare($sql);
        $stmt->execute($params);
        return $stmt->fetchAll();
    }

    public function getUserLogs($userId, $limit = 100) {
        $stmt = $this->db->prepare("
            SELECT * FROM logs 
            WHERE user_id = ? 
            ORDER BY created_at DESC 
            LIMIT ?
        ");
        $stmt->execute([$userId, $limit]);
        return $stmt->fetchAll();
    }

    public function logSession($userId, $action = 'login') {
        $sessionToken = session_id();
        
        if ($action === 'login') {
            $stmt = $this->db->prepare("
                INSERT INTO user_sessions (user_id, session_token, ip_address, user_agent) 
                VALUES (?, ?, ?, ?)
            ");
            $stmt->execute([$userId, $sessionToken, getClientIP(), getUserAgent()]);
        } else {
            $stmt = $this->db->prepare("
                UPDATE user_sessions 
                SET logout_at = NOW() 
                WHERE session_token = ? AND user_id = ?
            ");
            $stmt->execute([$sessionToken, $userId]);
        }

        return $this->createLog([
            'user_id' => $userId,
            'action' => $action,
            'target_table' => 'user_sessions'
        ]);
    }

    public function logError($error) {
        $stmt = $this->db->prepare("
            INSERT INTO error_logs (error_message, error_file, error_line, stack_trace, user_id, ip_address) 
            VALUES (?, ?, ?, ?, ?, ?)
        ");
        
        return $stmt->execute([
            $error['message'] ?? 'Unknown error',
            $error['file'] ?? '',
            $error['line'] ?? 0,
            $error['trace'] ?? '',
            $_SESSION['user_id'] ?? null,
            getClientIP()
        ]);
    }

    public function getErrorLogs($limit = 100) {
        $stmt = $this->db->prepare("
            SELECT * FROM error_logs 
            ORDER BY created_at DESC 
            LIMIT ?
        ");
        $stmt->execute([$limit]);
        return $stmt->fetchAll();
    }
}

18. APP/MODELS/SETTING.PHP
php<?php
namespace app\models;

use app\core\Model;
use PDO;

class Setting extends Model {
    protected $table = 'settings';

    public function getValue($key, $default = null) {
        $stmt = $this->db->prepare("SELECT setting_value FROM settings WHERE setting_key = ?");
        $stmt->execute([$key]);
        $result = $stmt->fetch();
        return $result ? $result['setting_value'] : $default;
    }

    public function setValue($key, $value) {
        $stmt = $this->db->prepare("
            INSERT INTO settings (setting_key, setting_value) 
            VALUES (?, ?) 
            ON DUPLICATE KEY UPDATE setting_value = ?
        ");
        return $stmt->execute([$key, $value, $value]);
    }

    public function getAll() {
        $stmt = $this->db->query("SELECT * FROM settings");
        $results = $stmt->fetchAll();
        
        $settings = [];
        foreach ($results as $row) {
            $settings[$row['setting_key']] = $row['setting_value'];
        }
        
        return $settings;
    }

    public function getSMTPSettings() {
        $keys = ['smtp_host', 'smtp_port', 'smtp_username', 'smtp_password', 'smtp_encryption', 'smtp_from_email', 'smtp_from_name'];
        $settings = [];
        
        foreach ($keys as $key) {
            $settings[$key] = $this->getValue($key, '');
        }
        
        return $settings;
    }

    public function getTelegramSettings() {
        return [
            'bot_token' => $this->getValue('telegram_bot_token', ''),
            'chat_ids' => json_decode($this->getValue('telegram_chat_ids', '[]'), true)
        ];
    }

    public function getNotificationSettings() {
        return [
            'email_enabled' => (bool) $this->getValue('notification_email_enabled', 0),
            'telegram_enabled' => (bool) $this->getValue('notification_telegram_enabled', 0)
        ];
    }

    public function updateSMTPSettings($data) {
        foreach ($data as $key => $value) {
            $this->setValue($key, $value);
        }
        return true;
    }

    public function updateTelegramSettings($data) {
        $this->setValue('telegram_bot_token', $data['bot_token'] ?? '');
        $this->setValue('telegram_chat_ids', json_encode($data['chat_ids'] ?? []));
        return true;
    }

    public function updateNotificationSettings($data) {
        $this->setValue('notification_email_enabled', $data['email_enabled'] ?? 0);
        $this->setValue('notification_telegram_enabled', $data['telegram_enabled'] ?? 0);
        return true;
    }
}
Karakter sınırı nedeniyle controller'ları bir sonraki mesajda göndereceğim.Kdevam et19. APP/CONTROLLERS/AUTHCONTROLLER.PHP
php<?php
namespace app\controllers;

use app\core\Controller;

class AuthController extends Controller {
    
    public function login() {
        if (isLoggedIn()) {
            $role = $_SESSION['role'];
            $this->redirect($role === 'admin' ? 'admin/dashboard' : 'teacher/dashboard');
        }

        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $this->validateCSRF();
            
            $email = sanitize($_POST['email']);
            $password = $_POST['password'];

            $userModel = $this->model('User');
            $result = $userModel->authenticate($email, $password);

            if ($result['success']) {
                $user = $result['user'];
                
                // Regenerate session ID
                session_regenerate_id(true);
                
                $_SESSION['user_id'] = $user['id'];
                $_SESSION['username'] = $user['username'];
                $_SESSION['email'] = $user['email'];
                $_SESSION['role'] = $user['role'];

                // Log session
                $logModel = $this->model('Log');
                $logModel->logSession($user['id'], 'login');
                $logModel->createLog([
                    'user_id' => $user['id'],
                    'action' => 'user_login',
                    'target_table' => 'users',
                    'target_id' => $user['id']
                ]);

                $redirectUrl = $user['role'] === 'admin' ? 'admin/dashboard' : 'teacher/dashboard';
                $this->redirect($redirectUrl);
            } else {
                flashMessage('error', $result['message']);
                $this->redirect('auth/login');
            }
        }

        $this->view('auth/login');
    }

    public function register() {
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $this->validateCSRF();
            
            $data = [
                'username' => sanitize($_POST['username']),
                'email' => sanitize($_POST['email']),
                'password' => $_POST['password'],
                'password_confirm' => $_POST['password_confirm'],
                'first_name' => sanitize($_POST['first_name']),
                'last_name' => sanitize($_POST['last_name']),
                'phone' => sanitize($_POST['phone'] ?? ''),
                'address' => sanitize($_POST['address'] ?? ''),
                'role' => 'teacher'
            ];

            // Validation
            $errors = [];

            if (empty($data['username']) || strlen($data['username']) < 3) {
                $errors[] = 'Kullanıcı adı en az 3 karakter olmalıdır';
            }

            if (empty($data['email']) || !filter_var($data['email'], FILTER_VALIDATE_EMAIL)) {
                $errors[] = 'Geçerli bir email adresi giriniz';
            }

            if (empty($data['password']) || strlen($data['password']) < 6) {
                $errors[] = 'Şifre en az 6 karakter olmalıdır';
            }

            if ($data['password'] !== $data['password_confirm']) {
                $errors[] = 'Şifreler eşleşmiyor';
            }

            if (empty($data['first_name']) || empty($data['last_name'])) {
                $errors[] = 'Ad ve soyad zorunludur';
            }

            $userModel = $this->model('User');

            // Check if user exists
            if ($userModel->findByEmail($data['email'])) {
                $errors[] = 'Bu email adresi zaten kayıtlı';
            }

            if ($userModel->findByUsername($data['username'])) {
                $errors[] = 'Bu kullanıcı adı zaten alınmış';
            }

            if (empty($errors)) {
                $userId = $userModel->register($data);
                
                if ($userId) {
                    $logModel = $this->model('Log');
                    $logModel->createLog([
                        'user_id' => null,
                        'action' => 'teacher_register',
                        'target_table' => 'users',
                        'target_id' => $userId,
                        'new_value' => [
                            'username' => $data['username'],
                            'email' => $data['email']
                        ]
                    ]);

                    flashMessage('success', 'Kaydınız başarıyla oluşturuldu. Admin onayından sonra giriş yapabilirsiniz.');
                    $this->redirect('auth/login');
                } else {
                    flashMessage('error', 'Kayıt sırasında bir hata oluştu');
                }
            } else {
                flashMessage('error', implode('<br>', $errors));
            }
        }

        $this->view('auth/register');
    }

    public function logout() {
        if (isset($_SESSION['user_id'])) {
            $logModel = $this->model('Log');
            $logModel->logSession($_SESSION['user_id'], 'logout');
            $logModel->createLog([
                'user_id' => $_SESSION['user_id'],
                'action' => 'user_logout',
                'target_table' => 'users',
                'target_id' => $_SESSION['user_id']
            ]);
        }

        session_unset();
        session_destroy();
        $this->redirect('auth/login');
    }

    public function unauthorized() {
        $this->view('auth/unauthorized');
    }
}

20. APP/CONTROLLERS/ADMINCONTROLLER.PHP
php<?php
namespace app\controllers;

use app\core\Controller;
use app\helpers\Mailer;
use app\helpers\Telegram;

class AdminController extends Controller {
    
    public function __construct() {
        $this->checkAuth('admin');
    }

    public function dashboard() {
        $studentModel = $this->model('Student');
        $userModel = $this->model('User');
        $classModel = $this->model('ClassModel');
        $subjectModel = $this->model('Subject');
        $logModel = $this->model('Log');
        $gradeModel = $this->model('Grade');

        $data = [
            'total_students' => count($studentModel->findAll()),
            'total_teachers' => count($userModel->getAllTeachers()),
            'total_classes' => count($classModel->findAll()),
            'total_subjects' => count($subjectModel->findAll()),
            'total_logs' => count($logModel->findAll()),
            'pending_teachers' => count($userModel->getPendingTeachers()),
            'recent_grades' => $gradeModel->getRecentGrades(null, 10)
        ];

        $this->view('admin/dashboard', $data);
    }

    // Teacher Management
    public function teachers() {
        $userModel = $this->model('User');
        $teachers = $userModel->getAllTeachers();
        $pending = $userModel->getPendingTeachers();

        $this->view('admin/teachers', [
            'teachers' => $teachers,
            'pending' => $pending
        ]);
    }

    public function approveTeacher($id) {
        $this->validateCSRF();
        
        $userModel = $this->model('User');
        $teacher = $userModel->findById($id);
        
        if ($teacher) {
            $userModel->updateStatus($id, 'active');
            
            $logModel = $this->model('Log');
            $logModel->createLog([
                'user_id' => $_SESSION['user_id'],
                'action' => 'teacher_approved',
                'target_table' => 'users',
                'target_id' => $id,
                'old_value' => ['status' => 'pending'],
                'new_value' => ['status' => 'active']
            ]);

            // Send notification
            $this->sendNotification(
                'Öğretmen Onaylandı',
                "Öğretmen onaylandı: {$teacher['email']}"
            );

            flashMessage('success', 'Öğretmen başarıyla onaylandı');
        }

        $this->redirect('admin/teachers');
    }

    public function rejectTeacher($id) {
        $this->validateCSRF();
        
        $userModel = $this->model('User');
        $teacher = $userModel->findById($id);
        
        if ($teacher) {
            $userModel->updateStatus($id, 'rejected');
            
            $logModel = $this->model('Log');
            $logModel->createLog([
                'user_id' => $_SESSION['user_id'],
                'action' => 'teacher_rejected',
                'target_table' => 'users',
                'target_id' => $id,
                'old_value' => ['status' => $teacher['status']],
                'new_value' => ['status' => 'rejected']
            ]);

            flashMessage('success', 'Öğretmen reddedildi');
        }

        $this->redirect('admin/teachers');
    }

    public function suspendTeacher($id) {
        $this->validateCSRF();
        
        $userModel = $this->model('User');
        $teacher = $userModel->findById($id);
        
        if ($teacher) {
            $newStatus = $teacher['status'] === 'suspended' ? 'active' : 'suspended';
            $userModel->updateStatus($id, $newStatus);
            
            $logModel = $this->model('Log');
            $logModel->createLog([
                'user_id' => $_SESSION['user_id'],
                'action' => 'teacher_status_changed',
                'target_table' => 'users',
                'target_id' => $id,
                'old_value' => ['status' => $teacher['status']],
                'new_value' => ['status' => $newStatus]
            ]);

            $message = $newStatus === 'suspended' ? 'Öğretmen askıya alındı' : 'Öğretmen aktif edildi';
            flashMessage('success', $message);
        }

        $this->redirect('admin/teachers');
    }

    public function teacherSubjects($id) {
        $userModel = $this->model('User');
        $subjectModel = $this->model('Subject');
        
        $teacher = $userModel->getTeacherProfile($id);
        $assignedSubjects = $userModel->getTeacherSubjects($id);
        $allSubjects = $subjectModel->findAll();

        $this->view('admin/teacher_subjects', [
            'teacher' => $teacher,
            'assigned_subjects' => $assignedSubjects,
            'all_subjects' => $allSubjects
        ]);
    }

    public function assignSubject() {
        $this->validateCSRF();
        
        $teacherId = sanitize($_POST['teacher_id']);
        $subjectId = sanitize($_POST['subject_id']);

        $userModel = $this->model('User');
        $userModel->assignSubject($teacherId, $subjectId);

        $logModel = $this->model('Log');
        $logModel->createLog([
            'user_id' => $_SESSION['user_id'],
            'action' => 'subject_assigned',
            'target_table' => 'teacher_subjects',
            'new_value' => [
                'teacher_id' => $teacherId,
                'subject_id' => $subjectId
            ]
        ]);

        flashMessage('success', 'Ders başarıyla atandı');
        $this->redirect('admin/teacherSubjects/' . $teacherId);
    }

    public function removeSubject() {
        $this->validateCSRF();
        
        $teacherId = sanitize($_POST['teacher_id']);
        $subjectId = sanitize($_POST['subject_id']);

        $userModel = $this->model('User');
        $userModel->removeSubject($teacherId, $subjectId);

        $logModel = $this->model('Log');
        $logModel->createLog([
            'user_id' => $_SESSION['user_id'],
            'action' => 'subject_removed',
            'target_table' => 'teacher_subjects',
            'old_value' => [
                'teacher_id' => $teacherId,
                'subject_id' => $subjectId
            ]
        ]);

        flashMessage('success', 'Ders ataması kaldırıldı');
        $this->redirect('admin/teacherSubjects/' . $teacherId);
    }

    // Student Management
    public function students() {
        $studentModel = $this->model('Student');
        $classModel = $this->model('ClassModel');

        $filters = [
            'class_id' => $_GET['class_id'] ?? '',
            'gender' => $_GET['gender'] ?? '',
            'search' => $_GET['search'] ?? ''
        ];

        $students = $studentModel->search($filters);
        $classes = $classModel->findAll();

        $this->view('admin/students', [
            'students' => $students,
            'classes' => $classes,
            'filters' => $filters
        ]);
    }

    public function addStudent() {
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $this->validateCSRF();

            $data = [
                'first_name' => sanitize($_POST['first_name']),
                'last_name' => sanitize($_POST['last_name']),
                'gender' => sanitize($_POST['gender']),
                'class_id' => !empty($_POST['class_id']) ? sanitize($_POST['class_id']) : null,
                'student_number' => sanitize($_POST['student_number']),
                'birth_date' => sanitize($_POST['birth_date'] ?? ''),
                'parent_phone' => sanitize($_POST['parent_phone'] ?? ''),
                'address' => sanitize($_POST['address'] ?? '')
            ];

            $studentModel = $this->model('Student');
            $studentId = $studentModel->createStudent($data);

            if ($studentId) {
                $logModel = $this->model('Log');
                $logModel->createLog([
                    'user_id' => $_SESSION['user_id'],
                    'action' => 'student_created',
                    'target_table' => 'students',
                    'target_id' => $studentId,
                    'new_value' => $data
                ]);

                flashMessage('success', 'Öğrenci başarıyla eklendi');
                $this->redirect('admin/students');
            }
        }

        $classModel = $this->model('ClassModel');
        $classes = $classModel->findAll();

        $this->view('admin/add_student', ['classes' => $classes]);
    }

    public function editStudent($id) {
        $studentModel = $this->model('Student');
        $student = $studentModel->findById($id);

        if (!$student) {
            flashMessage('error', 'Öğrenci bulunamadı');
            $this->redirect('admin/students');
        }

        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $this->validateCSRF();

            $oldData = $student;
            $newData = [
                'first_name' => sanitize($_POST['first_name']),
                'last_name' => sanitize($_POST['last_name']),
                'gender' => sanitize($_POST['gender']),
                'class_id' => !empty($_POST['class_id']) ? sanitize($_POST['class_id']) : null,
                'student_number' => sanitize($_POST['student_number']),
                'birth_date' => sanitize($_POST['birth_date'] ?? ''),
                'parent_phone' => sanitize($_POST['parent_phone'] ?? ''),
                'address' => sanitize($_POST['address'] ?? '')
            ];

            $studentModel->updateStudent($id, $newData);

            $logModel = $this->model('Log');
            $logModel->createLog([
                'user_id' => $_SESSION['user_id'],
                'action' => 'student_updated',
                'target_table' => 'students',
                'target_id' => $id,
                'old_value' => $oldData,
                'new_value' => $newData
            ]);

            flashMessage('success', 'Öğrenci başarıyla güncellendi');
            $this->redirect('admin/students');
        }

        $classModel = $this->model('ClassModel');
        $classes = $classModel->findAll();

        $this->view('admin/edit_student', [
            'student' => $student,
            'classes' => $classes
        ]);
    }

    public function deleteStudent($id) {
        $this->validateCSRF();

        $studentModel = $this->model('Student');
        $student = $studentModel->findById($id);

        if ($student) {
            $studentModel->delete($id);

            $logModel = $this->model('Log');
            $logModel->createLog([
                'user_id' => $_SESSION['user_id'],
                'action' => 'student_deleted',
                'target_table' => 'students',
                'target_id' => $id,
                'old_value' => $student
            ]);

            flashMessage('success', 'Öğrenci başarıyla silindi');
        }

        $this->redirect('admin/students');
    }

    public function studentDetails($id) {
        $studentModel = $this->model('Student');
        $student = $studentModel->findById($id);

        if (!$student) {
            flashMessage('error', 'Öğrenci bulunamadı');
            $this->redirect('admin/students');
        }

        $grades = $studentModel->getGradesGrouped($id);
        $behaviorNotes = $studentModel->getBehaviorNotes($id);
        $average = $studentModel->getOverallAverage($id);

        $this->view('admin/student_details', [
            'student' => $student,
            'grades' => $grades,
            'behavior_notes' => $behaviorNotes,
            'average' => $average
        ]);
    }

    public function exportStudentGrades($id) {
        $studentModel = $this->model('Student');
        $student = $studentModel->findById($id);

        if (!$student) {
            flashMessage('error', 'Öğrenci bulunamadı');
            $this->redirect('admin/students');
        }

        $json = $studentModel->exportGradesJSON($id);
        $filename = 'notlar_' . $student['student_number'] . '_' . date('Y-m-d') . '.json';

        header('Content-Type: application/json');
        header('Content-Disposition: attachment; filename="' . $filename . '"');
        echo $json;
        exit;
    }

    public function bulkAddStudents() {
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $this->validateCSRF();

            $studentsData = $_POST['students'] ?? [];
            
            if (empty($studentsData)) {
                flashMessage('error', 'Öğrenci verisi girilmedi');
                $this->redirect('admin/bulkAddStudents');
            }

            $studentModel = $this->model('Student');
            $result = $studentModel->bulkCreate($studentsData);

            $logModel = $this->model('Log');
            $logModel->createLog([
                'user_id' => $_SESSION['user_id'],
                'action' => 'bulk_students_created',
                'target_table' => 'students',
                'new_value' => [
                    'count' => $result['success']
                ]
            ]);

            flashMessage('success', "{$result['success']} öğrenci başarıyla eklendi");
            
            if (!empty($result['errors'])) {
                flashMessage('warning', 'Bazı öğrenciler eklenemedi: ' . implode(', ', $result['errors']));
            }

            $this->redirect('admin/students');
        }

        $classModel = $this->model('ClassModel');
        $classes = $classModel->findAll();

        $this->view('admin/bulk_add_students', ['classes' => $classes]);
    }

    // Class Management
    public function classes() {
        $classModel = $this->model('ClassModel');
        $classes = $classModel->getAllWithStudentCount();

        $this->view('admin/classes', ['classes' => $classes]);
    }

    public function addClass() {
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $this->validateCSRF();

            $data = [
                'name' => sanitize($_POST['name']),
                'description' => sanitize($_POST['description'] ?? '')
            ];

            $classModel = $this->model('ClassModel');
            $classId = $classModel->create($data);

            if ($classId) {
                $logModel = $this->model('Log');
                $logModel->createLog([
                    'user_id' => $_SESSION['user_id'],
                    'action' => 'class_created',
                    'target_table' => 'classes',
                    'target_id' => $classId,
                    'new_value' => $data
                ]);

                flashMessage('success', 'Sınıf başarıyla eklendi');
                $this->redirect('admin/classes');
            }
        }

        $this->view('admin/add_class');
    }

    public function editClass($id) {
        $classModel = $this->model('ClassModel');
        $class = $classModel->findById($id);

        if (!$class) {
            flashMessage('error', 'Sınıf bulunamadı');
            $this->redirect('admin/classes');
        }

        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $this->validateCSRF();

            $oldData = $class;
            $newData = [
                'name' => sanitize($_POST['name']),
                'description' => sanitize($_POST['description'] ?? '')
            ];

            $classModel->update($id, $newData);

            $logModel = $this->model('Log');
            $logModel->createLog([
                'user_id' => $_SESSION['user_id'],
                'action' => 'class_updated',
                'target_table' => 'classes',
                'target_id' => $id,
                'old_value' => $oldData,
                'new_value' => $newData
            ]);

            flashMessage('success', 'Sınıf başarıyla güncellendi');
            $this->redirect('admin/classes');
        }

        $this->view('admin/edit_class', ['class' => $class]);
    }

    public function deleteClass($id) {
        $this->validateCSRF();

        $classModel = $this->model('ClassModel');
        $class = $classModel->findById($id);

        if ($class) {
            $classModel->delete($id);

            $logModel = $this->model('Log');
            $logModel->createLog([
                'user_id' => $_SESSION['user_id'],
                'action' => 'class_deleted',
                'target_table' => 'classes',
                'target_id' => $id,
                'old_value' => $class
            ]);

            flashMessage('success', 'Sınıf başarıyla silindi');
        }

        $this->redirect('admin/classes');
    }

    // Subject Management
    public function subjects() {
        $subjectModel = $this->model('Subject');
        $subjects = $subjectModel->getAllWithTeachers();

        $this->view('admin/subjects', ['subjects' => $subjects]);
    }

    public function addSubject() {
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $this->validateCSRF();

            $data = [
                'name' => sanitize($_POST['name']),
                'code' => sanitize($_POST['code'] ?? ''),
                'description' => sanitize($_POST['description'] ?? '')
            ];

            $subjectModel = $this->model('Subject');
            $subjectId = $subjectModel->createSubject($data);

            if ($subjectId) {
                $logModel = $this->model('Log');
                $logModel->createLog([
                    'user_id' => $_SESSION['user_id'],
                    'action' => 'subject_created',
                    'target_table' => 'subjects',
                    'target_id' => $subjectId,
                    'new_value' => $data
                ]);

                flashMessage('success', 'Ders başarıyla eklendi');
                $this->redirect('admin/subjects');
            }
        }

        $this->view('admin/add_subject');
    }

    public function editSubject($id) {
        $subjectModel = $this->model('Subject');
        $subject = $subjectModel->findById($id);

        if (!$subject) {
            flashMessage('error', 'Ders bulunamadı');
            $this->redirect('admin/subjects');
        }

        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $this->validateCSRF();

            $oldData = $subject;
            $newData = [
                'name' => sanitize($_POST['name']),
                'code' => sanitize($_POST['code'] ?? ''),
                'description' => sanitize($_POST['description'] ?? '')
            ];

            $subjectModel->updateSubject($id, $newData);

            $logModel = $this->model('Log');
            $logModel->createLog([
                'user_id' => $_SESSION['user_id'],
                'action' => 'subject_updated',
                'target_table' => 'subjects',
                'target_id' => $id,
                'old_value' => $oldData,
                'new_value' => $newData
            ]);

            flashMessage('success', 'Ders başarıyla güncellendi');
            $this->redirect('admin/subjects');
        }

        $this->view('admin/edit_subject', ['subject' => $subject]);
    }

    public function deleteSubject($id) {
        $this->validateCSRF();

        $subjectModel = $this->model('Subject');
        
        if ($subjectModel->hasGrades($id)) {
            flashMessage('error', 'Bu ders için notlar girilmiş, silinemez');
            $this->redirect('admin/subjects');
        }

        $subject = $subjectModel->findById($id);

        if ($subject) {
            $subjectModel->delete($id);

            $logModel = $this->model('Log');
            $logModel->createLog([
                'user_id' => $_SESSION['user_id'],
                'action' => 'subject_deleted',
                'target_table' => 'subjects',
                'target_id' => $id,
                'old_value' => $subject
            ]);

            flashMessage('success', 'Ders başarıyla silindi');
        }

        $this->redirect('admin/subjects');
    }

    // Period Management
    public function periods() {
        $periodModel = $this->model('Period');
        $periods = $periodModel->findAll();

        $this->view('admin/periods', ['periods' => $periods]);
    }

    public function addPeriod() {
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $this->validateCSRF();

            $data = [
                'name' => sanitize($_POST['name']),
                'start_date' => sanitize($_POST['start_date'] ?? ''),
                'end_date' => sanitize($_POST['end_date'] ?? ''),
                'is_active' => isset($_POST['is_active']) ? 1 : 0
            ];

            $periodModel = $this->model('Period');
            $periodId = $periodModel->createPeriod($data);

            if ($periodId) {
                $logModel = $this->model('Log');
                $logModel->createLog([
                    'user_id' => $_SESSION['user_id'],
                    'action' => 'period_created',
                    'target_table' => 'periods',
                    'target_id' => $periodId,
                    'new_value' => $data
                ]);

                flashMessage('success', 'Dönem başarıyla eklendi');
                $this->redirect('admin/periods');
            }
        }

        $this->view('admin/add_period');
    }

    public function editPeriod($id) {
        $periodModel = $this->model('Period');
        $period = $periodModel->findById($id);

        if (!$period) {
            flashMessage('error', 'Dönem bulunamadı');
            $this->redirect('admin/periods');
        }

        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $this->validateCSRF();

            $oldData = $period;
            $newData = [
                'name' => sanitize($_POST['name']),
                'start_date' => sanitize($_POST['start_date'] ?? ''),
                'end_date' => sanitize($_POST['end_date'] ?? ''),
                'is_active' => isset($_POST['is_active']) ? 1 : 0
            ];

            $periodModel->updatePeriod($id, $newData);

            $logModel = $this->model('Log');
            $logModel->createLog([
                'user_id' => $_SESSION['user_id'],
                'action' => 'period_updated',
                'target_table' => 'periods',
                'target_id' => $id,
                'old_value' => $oldData,
                'new_value' => $newData
            ]);

            flashMessage('success', 'Dönem başarıyla güncellendi');
            $this->redirect('admin/periods');
        }

        $this->view('admin/edit_period', ['period' => $period]);
    }

    // Grade Management
    public function grades() {
        $gradeModel = $this->model('Grade');
        $grades = $gradeModel->getRecentGrades(null, 50);

        $this->view('admin/grades', ['grades' => $grades]);
    }

    public function gradeRevisions($gradeId) {
        $gradeModel = $this->model('Grade');
        $revisions = $gradeModel->getRevisions($gradeId);

        $this->view('admin/grade_revisions', ['revisions' => $revisions]);
    }

    // Logs
    public function logs() {
        $logModel = $this->model('Log');

        $filters = [
            'user_id' => $_GET['user_id'] ?? '',
            'action' => $_GET['action'] ?? '',
            'target_table' => $_GET['target_table'] ?? '',
            'date_from' => $_GET['date_from'] ?? '',
            'date_to' => $_GET['date_to'] ?? ''
        ];

        $logs = $logModel->getFiltered($filters);

        $userModel = $this->model('User');
        $users = $userModel->findAll();

        $this->view('admin/logs', [
            'logs' => $logs,
            'users' => $users,
            'filters' => $filters
        ]);
    }

    // Settings
    public function settings() {
        $settingModel = $this->model('Setting');
        $smtpSettings = $settingModel->getSMTPSettings();
        $telegramSettings = $settingModel->getTelegramSettings();
        $notificationSettings = $settingModel->getNotificationSettings();

        $this->view('admin/settings', [KContinue'smtp_settings' => $smtpSettings,
'telegram_settings' => $telegramSettings,
'notification_settings' => $notificationSettings
]);
}
public function updateSMTPSettings() {
    $this->validateCSRF();

    $data = [
        'smtp_host' => sanitize($_POST['smtp_host']),
        'smtp_port' => sanitize($_POST['smtp_port']),
        'smtp_username' => sanitize($_POST['smtp_username']),
        'smtp_password' => $_POST['smtp_password'],
        'smtp_encryption' => sanitize($_POST['smtp_encryption']),
        'smtp_from_email' => sanitize($_POST['smtp_from_email']),
        'smtp_from_name' => sanitize($_POST['smtp_from_name'])
    ];

    $settingModel = $this->model('Setting');
    $settingModel->updateSMTPSettings($data);

    $logModel = $this->model('Log');
    $logModel->createLog([
        'user_id' => $_SESSION['user_id'],
        'action' => 'smtp_settings_updated',
        'target_table' => 'settings',
        'new_value' => array_merge($data, ['smtp_password' => '***'])
    ]);

    flashMessage('success', 'SMTP ayarları güncellendi');
    $this->redirect('admin/settings');
}

public function testSMTP() {
    $this->validateCSRF();

    $settingModel = $this->model('Setting');
    $smtpSettings = $settingModel->getSMTPSettings();

    if (empty($smtpSettings['smtp_host']) || empty($smtpSettings['smtp_username'])) {
        $this->json(['success' => false, 'message' => 'SMTP ayarları eksik']);
    }

    try {
        $mailer = new Mailer($smtpSettings);
        $result = $mailer->send(
            $smtpSettings['smtp_from_email'],
            'Test Mail',
            'Bu bir test mailidir.'
        );

        $this->json([
            'success' => $result,
            'message' => $result ? 'Test maili başarıyla gönderildi' : 'Test maili gönderilemedi'
        ]);
    } catch (\Exception $e) {
        $this->json(['success' => false, 'message' => $e->getMessage()]);
    }
}

public function updateTelegramSettings() {
    $this->validateCSRF();

    $chatIds = isset($_POST['chat_ids']) ? explode(',', $_POST['chat_ids']) : [];
    $chatIds = array_map('trim', $chatIds);
    $chatIds = array_filter($chatIds);

    $data = [
        'bot_token' => sanitize($_POST['bot_token']),
        'chat_ids' => $chatIds
    ];

    $settingModel = $this->model('Setting');
    $settingModel->updateTelegramSettings($data);

    $logModel = $this->model('Log');
    $logModel->createLog([
        'user_id' => $_SESSION['user_id'],
        'action' => 'telegram_settings_updated',
        'target_table' => 'settings',
        'new_value' => $data
    ]);

    flashMessage('success', 'Telegram ayarları güncellendi');
    $this->redirect('admin/settings');
}

public function testTelegram() {
    $this->validateCSRF();

    $settingModel = $this->model('Setting');
    $telegramSettings = $settingModel->getTelegramSettings();

    if (empty($telegramSettings['bot_token']) || empty($telegramSettings['chat_ids'])) {
        $this->json(['success' => false, 'message' => 'Telegram ayarları eksik']);
    }

    $telegram = new Telegram($telegramSettings['bot_token'], $telegramSettings['chat_ids']);
    $result = $telegram->sendMessage('Test mesajı - Sistem çalışıyor!');

    $this->json([
        'success' => $result,
        'message' => $result ? 'Test mesajı başarıyla gönderildi' : 'Test mesajı gönderilemedi'
    ]);
}

public function updateNotificationSettings() {
    $this->validateCSRF();

    $data = [
        'email_enabled' => isset($_POST['email_enabled']) ? 1 : 0,
        'telegram_enabled' => isset($_POST['telegram_enabled']) ? 1 : 0
    ];

    $settingModel = $this->model('Setting');
    $settingModel->updateNotificationSettings($data);

    $logModel = $this->model('Log');
    $logModel->createLog([
        'user_id' => $_SESSION['user_id'],
        'action' => 'notification_settings_updated',
        'target_table' => 'settings',
        'new_value' => $data
    ]);

    flashMessage('success', 'Bildirim ayarları güncellendi');
    $this->redirect('admin/settings');
}

// Backup
public function backup() {
    $this->view('admin/backup');
}

public function generateBackup() {
    $this->validateCSRF();

    try {
        $db = \app\core\Database::getInstance()->getConnection();
        $tables = [];

        $result = $db->query("SHOW TABLES");
        while ($row = $result->fetch(\PDO::FETCH_NUM)) {
            $tables[] = $row[0];
        }

        $sql = "-- Database Backup\n";
        $sql .= "-- Generated: " . date('Y-m-d H:i:s') . "\n\n";
        $sql .= "SET FOREIGN_KEY_CHECKS=0;\n\n";

        foreach ($tables as $table) {
            $sql .= "DROP TABLE IF EXISTS `{$table}`;\n";
            
            $result = $db->query("SHOW CREATE TABLE `{$table}`");
            $row = $result->fetch(\PDO::FETCH_NUM);
            $sql .= $row[1] . ";\n\n";

            $result = $db->query("SELECT * FROM `{$table}`");
            $columnCount = $result->columnCount();

            while ($row = $result->fetch(\PDO::FETCH_NUM)) {
                $sql .= "INSERT INTO `{$table}` VALUES(";
                for ($i = 0; $i < $columnCount; $i++) {
                    $sql .= isset($row[$i]) ? $db->quote($row[$i]) : 'NULL';
                    if ($i < $columnCount - 1) {
                        $sql .= ',';
                    }
                }
                $sql .= ");\n";
            }
            $sql .= "\n";
        }

        $sql .= "SET FOREIGN_KEY_CHECKS=1;\n";

        $filename = 'backup_' . date('Y-m-d_His') . '.sql';
        
        header('Content-Type: application/octet-stream');
        header('Content-Disposition: attachment; filename="' . $filename . '"');
        header('Content-Length: ' . strlen($sql));
        echo $sql;

        $logModel = $this->model('Log');
        $logModel->createLog([
            'user_id' => $_SESSION['user_id'],
            'action' => 'database_backup',
            'target_table' => 'system'
        ]);

        exit;
    } catch (\Exception $e) {
        flashMessage('error', 'Yedekleme hatası: ' . $e->getMessage());
        $this->redirect('admin/backup');
    }
}

public function restoreBackup() {
    $this->validateCSRF();

    if (!isset($_FILES['backup_file'])) {
        flashMessage('error', 'Dosya seçilmedi');
        $this->redirect('admin/backup');
    }

    $file = $_FILES['backup_file'];
    
    if ($file['error'] !== UPLOAD_ERR_OK) {
        flashMessage('error', 'Dosya yükleme hatası');
        $this->redirect('admin/backup');
    }

    $ext = pathinfo($file['name'], PATHINFO_EXTENSION);
    if ($ext !== 'sql') {
        flashMessage('error', 'Geçersiz dosya formatı');
        $this->redirect('admin/backup');
    }

    try {
        $sql = file_get_contents($file['tmp_name']);
        $db = \app\core\Database::getInstance()->getConnection();
        $db->exec($sql);

        $logModel = $this->model('Log');
        $logModel->createLog([
            'user_id' => $_SESSION['user_id'],
            'action' => 'database_restore',
            'target_table' => 'system',
            'new_value' => ['filename' => $file['name']]
        ]);

        flashMessage('success', 'Veritabanı başarıyla geri yüklendi');
    } catch (\Exception $e) {
        flashMessage('error', 'Geri yükleme hatası: ' . $e->getMessage());
    }

    $this->redirect('admin/backup');
}

// Helper method for notifications
private function sendNotification($title, $message) {
    $settingModel = $this->model('Setting');
    $notificationSettings = $settingModel->getNotificationSettings();

    if ($notificationSettings['email_enabled']) {
        $smtpSettings = $settingModel->getSMTPSettings();
        if (!empty($smtpSettings['smtp_host'])) {
            $mailer = new Mailer($smtpSettings);
            $mailer->send(
                $smtpSettings['smtp_from_email'],
                $title,
                $message
            );
        }
    }

    if ($notificationSettings['telegram_enabled']) {
        $telegramSettings = $settingModel->getTelegramSettings();
        if (!empty($telegramSettings['bot_token'])) {
            $telegram = new Telegram(
                $telegramSettings['bot_token'],
                $telegramSettings['chat_ids']
            );
            $telegram->sendNotification($title, $message);
        }
    }
}
}

---

## 21. APP/CONTROLLERS/TEACHERCONTROLLER.PHP
```php
<?php
namespace app\controllers;

use app\core\Controller;
use app\helpers\Telegram;

class TeacherController extends Controller {
    
    public function __construct() {
        $this->checkAuth('teacher');
    }

    public function dashboard() {
        $userModel = $this->model('User');
        $gradeModel = $this->model('Grade');
        
        $subjects = $userModel->getTeacherSubjects($_SESSION['user_id']);
        $recentGrades = $gradeModel->getRecentGrades($_SESSION['user_id'], 10);

        // Count classes for assigned subjects
        $classModel = $this->model('ClassModel');
        $allClasses = $classModel->findAll();

        $this->view('teacher/dashboard', [
            'subjects' => $subjects,
            'recent_grades' => $recentGrades,
            'subject_count' => count($subjects),
            'class_count' => count($allClasses)
        ]);
    }

    public function profile() {
        $userModel = $this->model('User');
        $profile = $userModel->getTeacherProfile($_SESSION['user_id']);

        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $this->validateCSRF();

            $data = [
                'username' => sanitize($_POST['username']),
                'email' => sanitize($_POST['email']),
                'first_name' => sanitize($_POST['first_name']),
                'last_name' => sanitize($_POST['last_name']),
                'phone' => sanitize($_POST['phone'] ?? ''),
                'address' => sanitize($_POST['address'] ?? '')
            ];

            $userModel->updateProfile($_SESSION['user_id'], $data);

            $logModel = $this->model('Log');
            $logModel->createLog([
                'user_id' => $_SESSION['user_id'],
                'action' => 'profile_updated',
                'target_table' => 'users',
                'target_id' => $_SESSION['user_id']
            ]);

            flashMessage('success', 'Profil başarıyla güncellendi');
            $this->redirect('teacher/profile');
        }

        $this->view('teacher/profile', ['profile' => $profile]);
    }

    public function changePassword() {
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $this->validateCSRF();

            $currentPassword = $_POST['current_password'];
            $newPassword = $_POST['new_password'];
            $confirmPassword = $_POST['confirm_password'];

            $userModel = $this->model('User');
            $user = $userModel->findById($_SESSION['user_id']);

            $errors = [];

            if (!password_verify($currentPassword, $user['password'])) {
                $errors[] = 'Mevcut şifre hatalı';
            }

            if (strlen($newPassword) < 6) {
                $errors[] = 'Yeni şifre en az 6 karakter olmalıdır';
            }

            if ($newPassword !== $confirmPassword) {
                $errors[] = 'Yeni şifreler eşleşmiyor';
            }

            if (empty($errors)) {
                $userModel->changePassword($_SESSION['user_id'], $newPassword);

                $logModel = $this->model('Log');
                $logModel->createLog([
                    'user_id' => $_SESSION['user_id'],
                    'action' => 'password_changed',
                    'target_table' => 'users',
                    'target_id' => $_SESSION['user_id']
                ]);

                flashMessage('success', 'Şifre başarıyla değiştirildi');
                $this->redirect('teacher/profile');
            } else {
                flashMessage('error', implode('<br>', $errors));
            }
        }

        $this->view('teacher/change_password');
    }

    public function grades() {
        $userModel = $this->model('User');
        $subjects = $userModel->getTeacherSubjects($_SESSION['user_id']);

        $classModel = $this->model('ClassModel');
        $classes = $classModel->findAll();

        $periodModel = $this->model('Period');
        $periods = $periodModel->getActive();

        $this->view('teacher/grades', [
            'subjects' => $subjects,
            'classes' => $classes,
            'periods' => $periods
        ]);
    }

    public function gradeEntry() {
        $classId = $_GET['class_id'] ?? null;
        $subjectId = $_GET['subject_id'] ?? null;
        $periodId = $_GET['period_id'] ?? null;

        if (!$classId || !$subjectId || !$periodId) {
            flashMessage('error', 'Sınıf, ders ve dönem seçimi zorunludur');
            $this->redirect('teacher/grades');
        }

        // Check if teacher has access to this subject
        $userModel = $this->model('User');
        $teacherSubjects = $userModel->getTeacherSubjects($_SESSION['user_id']);
        $hasAccess = false;
        foreach ($teacherSubjects as $subject) {
            if ($subject['id'] == $subjectId) {
                $hasAccess = true;
                break;
            }
        }

        if (!$hasAccess) {
            flashMessage('error', 'Bu derse erişim yetkiniz yok');
            $this->redirect('teacher/grades');
        }

        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $this->validateCSRF();

            $grades = $_POST['grades'] ?? [];
            $gradeModel = $this->model('Grade');
            $success = 0;

            foreach ($grades as $studentId => $gradeValue) {
                if (!empty($gradeValue)) {
                    $gradeData = [
                        'student_id' => $studentId,
                        'subject_id' => $subjectId,
                        'period_id' => $periodId,
                        'grade' => $gradeValue,
                        'teacher_id' => $_SESSION['user_id']
                    ];

                    $gradeModel->addGrade($gradeData);
                    $success++;
                }
            }

            if ($success > 0) {
                $logModel = $this->model('Log');
                $logModel->createLog([
                    'user_id' => $_SESSION['user_id'],
                    'action' => 'grades_entered',
                    'target_table' => 'grades',
                    'new_value' => [
                        'class_id' => $classId,
                        'subject_id' => $subjectId,
                        'period_id' => $periodId,
                        'count' => $success
                    ]
                ]);

                // Send notification to admin
                $this->sendGradeNotification($classId, $subjectId, $periodId, $success);

                flashMessage('success', "{$success} not başarıyla kaydedildi");
            }

            $this->redirect('teacher/gradeEntry?class_id=' . $classId . '&subject_id=' . $subjectId . '&period_id=' . $periodId);
        }

        $classModel = $this->model('ClassModel');
        $students = $classModel->getClassGrades($classId, $subjectId, $periodId);
        $class = $classModel->findById($classId);

        $subjectModel = $this->model('Subject');
        $subject = $subjectModel->findById($subjectId);

        $periodModel = $this->model('Period');
        $period = $periodModel->findById($periodId);

        $this->view('teacher/grade_entry', [
            'students' => $students,
            'class' => $class,
            'subject' => $subject,
            'period' => $period
        ]);
    }

    public function viewGrades() {
        $classId = $_GET['class_id'] ?? null;
        $subjectId = $_GET['subject_id'] ?? null;
        $periodId = $_GET['period_id'] ?? null;

        $userModel = $this->model('User');
        $subjects = $userModel->getTeacherSubjects($_SESSION['user_id']);

        $classModel = $this->model('ClassModel');
        $classes = $classModel->findAll();

        $periodModel = $this->model('Period');
        $periods = $periodModel->getActive();

        $students = [];
        $class = null;
        $subject = null;
        $period = null;

        if ($classId && $subjectId && $periodId) {
            $students = $classModel->getClassGrades($classId, $subjectId, $periodId);
            $class = $classModel->findById($classId);
            
            $subjectModel = $this->model('Subject');
            $subject = $subjectModel->findById($subjectId);
            $period = $periodModel->findById($periodId);
        }

        $this->view('teacher/view_grades', [
            'subjects' => $subjects,
            'classes' => $classes,
            'periods' => $periods,
            'students' => $students,
            'class' => $class,
            'subject' => $subject,
            'period' => $period
        ]);
    }

    public function behaviorNotes() {
        $studentModel = $this->model('Student');
        $classModel = $this->model('ClassModel');
        
        $students = $studentModel->getAllWithClass();
        $classes = $classModel->findAll();

        $this->view('teacher/behavior_notes', [
            'students' => $students,
            'classes' => $classes
        ]);
    }

    public function addBehaviorNote() {
        $this->validateCSRF();

        $studentId = sanitize($_POST['student_id']);
        $note = sanitize($_POST['note']);
        $noteDate = sanitize($_POST['note_date']);

        $db = \app\core\Database::getInstance()->getConnection();
        $stmt = $db->prepare("
            INSERT INTO behavior_notes (student_id, teacher_id, note, note_date) 
            VALUES (?, ?, ?, ?)
        ");
        $stmt->execute([$studentId, $_SESSION['user_id'], $note, $noteDate]);

        $logModel = $this->model('Log');
        $logModel->createLog([
            'user_id' => $_SESSION['user_id'],
            'action' => 'behavior_note_added',
            'target_table' => 'behavior_notes',
            'target_id' => $db->lastInsertId(),
            'new_value' => [
                'student_id' => $studentId,
                'note' => $note,
                'note_date' => $noteDate
            ]
        ]);

        flashMessage('success', 'Davranış notu başarıyla eklendi');
        $this->redirect('teacher/behaviorNotes');
    }

    public function viewStudent($id) {
        $studentModel = $this->model('Student');
        $student = $studentModel->findById($id);

        if (!$student) {
            flashMessage('error', 'Öğrenci bulunamadı');
            $this->redirect('teacher/behaviorNotes');
        }

        $grades = $studentModel->getGradesGrouped($id);
        $behaviorNotes = $studentModel->getBehaviorNotes($id);

        // Filter grades to show only teacher's subjects
        $userModel = $this->model('User');
        $teacherSubjects = $userModel->getTeacherSubjects($_SESSION['user_id']);
        $teacherSubjectIds = array_column($teacherSubjects, 'id');

        $filteredGrades = [];
        foreach ($grades as $period => $periodGrades) {
            $filteredGrades[$period] = array_filter($periodGrades, function($grade) use ($teacherSubjectIds) {
                return in_array($grade['subject_id'], $teacherSubjectIds);
            });
        }

        $this->view('teacher/view_student', [
            'student' => $student,
            'grades' => $filteredGrades,
            'behavior_notes' => $behaviorNotes
        ]);
    }

    public function myLogs() {
        $logModel = $this->model('Log');
        $logs = $logModel->getUserLogs($_SESSION['user_id'], 100);

        $this->view('teacher/my_logs', ['logs' => $logs]);
    }

    public function missingGrades() {
        $classId = $_GET['class_id'] ?? null;
        $subjectId = $_GET['subject_id'] ?? null;
        $periodId = $_GET['period_id'] ?? null;

        $userModel = $this->model('User');
        $subjects = $userModel->getTeacherSubjects($_SESSION['user_id']);

        $classModel = $this->model('ClassModel');
        $classes = $classModel->findAll();

        $periodModel = $this->model('Period');
        $periods = $periodModel->getActive();

        $missingStudents = [];

        if ($classId && $subjectId && $periodId) {
            $gradeModel = $this->model('Grade');
            $missingStudents = $gradeModel->getMissingGrades($classId, $subjectId, $periodId);
        }

        $this->view('teacher/missing_grades', [
            'subjects' => $subjects,
            'classes' => $classes,
            'periods' => $periods,
            'missing_students' => $missingStudents,
            'class_id' => $classId,
            'subject_id' => $subjectId,
            'period_id' => $periodId
        ]);
    }

    private function sendGradeNotification($classId, $subjectId, $periodId, $count) {
        $settingModel = $this->model('Setting');
        $notificationSettings = $settingModel->getNotificationSettings();

        if (!$notificationSettings['telegram_enabled']) {
            return;
        }

        $classModel = $this->model('ClassModel');
        $class = $classModel->findById($classId);

        $subjectModel = $this->model('Subject');
        $subject = $subjectModel->findById($subjectId);

        $periodModel = $this->model('Period');
        $period = $periodModel->findById($periodId);

        $userModel = $this->model('User');
        $teacher = $userModel->getTeacherProfile($_SESSION['user_id']);

        $message = "📝 <b>Yeni Not Girişi</b>\n\n";
        $message .= "Öğretmen: {$teacher['first_name']} {$teacher['last_name']}\n";
        $message .= "Sınıf: {$class['name']}\n";
        $message .= "Ders: {$subject['name']}\n";
        $message .= "Dönem: {$period['name']}\n";
        $message .= "Not Sayısı: {$count}";

        $telegramSettings = $settingModel->getTelegramSettings();
        if (!empty($telegramSettings['bot_token'])) {
            $telegram = new Telegram(
                $telegramSettings['bot_token'],
                $telegramSettings['chat_ids']
            );
            $telegram->sendMessage($message);
        }
    }
}
```

---

## 22. APP/CONTROLLERS/APICONTROLLER.PHP
```php
<?php
namespace app\controllers;

use app\core\Controller;

class ApiController extends Controller {
    
    public function getStudentsByClass() {
        if (!isLoggedIn()) {
            $this->json(['error' => 'Unauthorized'], 401);
        }

        $classId = $_GET['class_id'] ?? null;
        
        if (!$classId) {
            $this->json(['error' => 'Class ID required'], 400);
        }

        $studentModel = $this->model('Student');
        $students = $studentModel->getByClass($classId);

        $this->json(['students' => $students]);
    }

    public function getClassAverage() {
        if (!isLoggedIn()) {
            $this->json(['error' => 'Unauthorized'], 401);
        }

        $classId = $_GET['class_id'] ?? null;
        $subjectId = $_GET['subject_id'] ?? null;
        $periodId = $_GET['period_id'] ?? null;

        if (!$classId) {
            $this->json(['error' => 'Class ID required'], 400);
        }

        $classModel = $this->model('ClassModel');
        $average = $classModel->getClassAverage($classId, $subjectId, $periodId);

        $this->json(['average' => $average]);
    }

    public function checkStudentNumber() {
        if (!isAdmin()) {
            $this->json(['error' => 'Unauthorized'], 401);
        }

        $studentNumber = $_GET['student_number'] ?? '';
        $excludeId = $_GET['exclude_id'] ?? null;

        $db = \app\core\Database::getInstance()->getConnection();
        $sql = "SELECT id FROM students WHERE student_number = ?";
        $params = [$studentNumber];

        if ($excludeId) {
            $sql .= " AND id != ?";
            $params[] = $excludeId;
        }

        $stmt = $db->prepare($sql);
        $stmt->execute($params);
        $exists = $stmt->fetch();

        $this->json(['exists' => (bool)$exists]);
    }
}
```

Karakter sınırı nedeniyle view dosyalarını bir sonraki mesajda göndereceğim.Kdevam et23. PUBLIC/ASSETS/CSS/STYLE.CSS
css:root {
    --primary-color: #0a3255;
    --primary-hover: #082744;
    --text-dark: #2c3e50;
    --text-light: #6c757d;
    --border-color: #dee2e6;
    --bg-light: #f8f9fa;
    --success: #28a745;
    --danger: #dc3545;
    --warning: #ffc107;
    --info: #17a2b8;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f5f6fa;
    color: var(--text-dark);
}

/* Sidebar */
.sidebar {
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    width: 260px;
    background: white;
    box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
    z-index: 1000;
}

.sidebar.collapsed {
    width: 70px;
}

.sidebar-header {
    padding: 20px;
    background: var(--primary-color);
    color: white;
    text-align: center;
}

.sidebar-header h3 {
    font-size: 18px;
    margin: 0;
}

.sidebar.collapsed .sidebar-header h3 {
    display: none;
}

.sidebar-menu {
    list-style: none;
    padding: 20px 0;
}

.sidebar-menu li {
    margin: 5px 0;
}

.sidebar-menu a {
    display: flex;
    align-items: center;
    padding: 12px 20px;
    color: var(--text-dark);
    text-decoration: none;
    transition: all 0.3s ease;
}

.sidebar-menu a:hover,
.sidebar-menu a.active {
    background: var(--bg-light);
    color: var(--primary-color);
    border-left: 3px solid var(--primary-color);
}

.sidebar-menu i {
    margin-right: 10px;
    font-size: 20px;
    min-width: 30px;
}

.sidebar.collapsed .sidebar-menu span {
    display: none;
}

.sidebar-toggle {
    position: absolute;
    top: 20px;
    right: -15px;
    width: 30px;
    height: 30px;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Main Content */
.main-content {
    margin-left: 260px;
    padding: 20px;
    transition: all 0.3s ease;
    min-height: 100vh;
}

.main-content.expanded {
    margin-left: 70px;
}

/* Header */
.page-header {
    background: white;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.page-header h1 {
    font-size: 24px;
    color: var(--text-dark);
    margin: 0;
}

.user-info {
    display: flex;
    align-items: center;
    gap: 15px;
}

.user-info span {
    color: var(--text-light);
}

/* Cards */
.card {
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    margin-bottom: 20px;
}

.card-header {
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 15px;
    margin-bottom: 15px;
}

.card-header h3 {
    font-size: 18px;
    margin: 0;
    color: var(--text-dark);
}

/* Stats Cards */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

.stat-card {
    background: white;
    padding: 25px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    display: flex;
    align-items: center;
    gap: 20px;
}

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    color: white;
}

.stat-icon.primary { background: var(--primary-color); }
.stat-icon.success { background: var(--success); }
.stat-icon.warning { background: var(--warning); }
.stat-icon.danger { background: var(--danger); }
.stat-icon.info { background: var(--info); }

.stat-content h4 {
    font-size: 32px;
    margin: 0 0 5px 0;
    color: var(--text-dark);
}

.stat-content p {
    margin: 0;
    color: var(--text-light);
    font-size: 14px;
}

/* Tables */
.table-responsive {
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
}

table thead {
    background: var(--bg-light);
}

table th,
table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid var(--border-color);
}

table th {
    font-weight: 600;
    color: var(--text-dark);
}

table tbody tr:hover {
    background: var(--bg-light);
}

/* Buttons */
.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    text-decoration: none;
    display: inline-block;
    transition: all 0.3s ease;
}

.btn-primary {
    background: var(--primary-color);
    color: white;
}

.btn-primary:hover {
    background: var(--primary-hover);
}

.btn-success {
    background: var(--success);
    color: white;
}

.btn-success:hover {
    background: #218838;
}

.btn-danger {
    background: var(--danger);
    color: white;
}

.btn-danger:hover {
    background: #c82333;
}

.btn-warning {
    background: var(--warning);
    color: #212529;
}

.btn-info {
    background: var(--info);
    color: white;
}

.btn-sm {
    padding: 5px 10px;
    font-size: 12px;
}

/* Forms */
.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    color: var(--text-dark);
    font-weight: 500;
}

.form-control {
    width: 100%;
    padding: 10px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    font-size: 14px;
}

.form-control:focus {
    outline: none;
    border-color: var(--primary-color);
}

select.form-control {
    cursor: pointer;
}

textarea.form-control {
    min-height: 100px;
    resize: vertical;
}

/* Badges */
.badge {
    padding: 5px 10px;
    border-radius: 3px;
    font-size: 12px;
    font-weight: 500;
}

.badge-success {
    background: #d4edda;
    color: #155724;
}

.badge-warning {
    background: #fff3cd;
    color: #856404;
}

.badge-danger {
    background: #f8d7da;
    color: #721c24;
}

.badge-info {
    background: #d1ecf1;
    color: #0c5460;
}

.badge-secondary {
    background: #e2e3e5;
    color: #383d41;
}

/* Alerts */
.alert {
    padding: 15px;
    border-radius: 5px;
    margin-bottom: 20px;
}

.alert-success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.alert-error,
.alert-danger {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.alert-warning {
    background: #fff3cd;
    color: #856404;
    border: 1px solid #ffeaa7;
}

.alert-info {
    background: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
}

.modal.show {
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: white;
    padding: 30px;
    border-radius: 8px;
    max-width: 500px;
    width: 90%;
}

.modal-header {
    margin-bottom: 20px;
}

.modal-header h3 {
    margin: 0;
}

.modal-footer {
    margin-top: 20px;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

/* Loading */
.loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Auth Pages */
.auth-container {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
}

.auth-card {
    background: white;
    padding: 40px;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    max-width: 450px;
    width: 90%;
}

.auth-card h2 {
    text-align: center;
    margin-bottom: 30px;
    color: var(--primary-color);
}

/* Filters */
.filters {
    background: white;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.filters-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

/* Responsive */
@media (max-width: 768px) {
    .sidebar {
        transform: translateX(-100%);
    }
    
    .sidebar.show {
        transform: translateX(0);
    }
    
    .main-content {
        margin-left: 0;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .page-header {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
    }
}

/* Utility Classes */
.text-center { text-align: center; }
.text-right { text-align: right; }
.text-left { text-align: left; }
.mt-1 { margin-top: 10px; }
.mt-2 { margin-top: 20px; }
.mb-1 { margin-bottom: 10px; }
.mb-2 { margin-bottom: 20px; }
.p-1 { padding: 10px; }
.p-2 { padding: 20px; }
.d-flex { display: flex; }
.justify-between { justify-content: space-between; }
.align-center { align-items: center; }
.gap-1 { gap: 10px; }
.gap-2 { gap: 20px; }
.w-100 { width: 100%; }

24. PUBLIC/ASSETS/JS/MAIN.JS
javascript// Sidebar Toggle
document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.querySelector('.sidebar');
    const mainContent = document.querySelector('.main-content');
    const toggleBtn = document.querySelector('.sidebar-toggle');

    if (toggleBtn) {
        toggleBtn.addEventListener('click', function() {
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
        });
    }

    // Mobile menu toggle
    const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
    if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener('click', function() {
            sidebar.classList.toggle('show');
        });
    }

    // Close sidebar on outside click (mobile)
    document.addEventListener('click', function(e) {
        if (window.innerWidth <= 768) {
            if (!sidebar.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                sidebar.classList.remove('show');
            }
        }
    });
});

// Toast Notifications
function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.innerHTML = message;
    
    const container = document.getElementById('toast-container') || createToastContainer();
    container.appendChild(toast);
    
    setTimeout(() => {
        toast.classList.add('show');
    }, 100);
    
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

function createToastContainer() {
    const container = document.createElement('div');
    container.id = 'toast-container';
    container.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
    `;
    document.body.appendChild(container);
    return container;
}

// Modal Functions
function openModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.classList.add('show');
    }
}

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.classList.remove('show');
    }
}

// Close modal on outside click
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('modal')) {
        e.target.classList.remove('show');
    }
});

// Confirm Delete
function confirmDelete(message = 'Bu işlem geri alınamaz. Emin misiniz?') {
    return confirm(message);
}

// Form Validation
function validateForm(formId) {
    const form = document.getElementById(formId);
    if (!form) return false;
    
    const inputs = form.querySelectorAll('[required]');
    let isValid = true;
    
    inputs.forEach(input => {
        if (!input.value.trim()) {
            isValid = false;
            input.classList.add('is-invalid');
        } else {
            input.classList.remove('is-invalid');
        }
    });
    
    return isValid;
}

// AJAX Helper
async function fetchAPI(url, options = {}) {
    try {
        const response = await fetch(url, {
            ...options,
            headers: {
                'Content-Type': 'application/json',
                ...options.headers
            }
        });
        
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        
        return await response.json();
    } catch (error) {
        console.error('Fetch error:', error);
        showToast('Bir hata oluştu', 'error');
        throw error;
    }
}

// Format Date
function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('tr-TR');
}

function formatDateTime(dateString) {
    const date = new Date(dateString);
    return date.toLocaleString('tr-TR');
}

// Auto-hide alerts
document.addEventListener('DOMContentLoaded', function() {
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach(alert => {
        setTimeout(() => {
            alert.style.opacity = '0';
            setTimeout(() => alert.remove(), 300);
        }, 5000);
    });
});

// Table Search
function searchTable(inputId, tableId) {
    const input = document.getElementById(inputId);
    const table = document.getElementById(tableId);
    
    if (!input || !table) return;
    
    input.addEventListener('keyup', function() {
        const filter = this.value.toLowerCase();
        const rows = table.querySelectorAll('tbody tr');
        
        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(filter) ? '' : 'none';
        });
    });
}

// Student Number Generator
function generateStudentNumber() {
    const year = new Date().getFullYear();
    const random = Math.floor(Math.random() * 9999).toString().padStart(4, '0');
    return `STU${year}${random}`;
}

// Check Student Number Availability
async function checkStudentNumber(studentNumber, excludeId = null) {
    try {
        let url = `/api/checkStudentNumber?student_number=${studentNumber}`;
        if (excludeId) {
            url += `&exclude_id=${excludeId}`;
        }
        
        const data = await fetchAPI(url);
        return data.exists;
    } catch (error) {
        return false;
    }
}

// Grade Input Validation
function validateGrade(input) {
    const value = parseFloat(input.value);
    
    if (isNaN(value) || value < 0 || value > 100) {
        input.classList.add('is-invalid');
        return false;
    }
    
    input.classList.remove('is-invalid');
    return true;
}

// Bulk Grade Entry
function enableBulkGradeEntry() {
    const gradeInputs = document.querySelectorAll('.grade-input');
    
    gradeInputs.forEach(input => {
        input.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const nextInput = this.closest('tr').nextElementSibling?.querySelector('.grade-input');
                if (nextInput) {
                    nextInput.focus();
                }
            }
        });
        
        input.addEventListener('input', function() {
            validateGrade(this);
        });
    });
}

// Calculate Class Average
function calculateClassAverage(grades) {
    if (!grades.length) return 0;
    
    const sum = grades.reduce((acc, grade) => acc + parseFloat(grade), 0);
    return (sum / grades.length).toFixed(2);
}

// Export to JSON
function exportToJSON(data, filename) {
    const json = JSON.stringify(data, null, 2);
    const blob = new Blob([json], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// Print Function
function printElement(elementId) {
    const element = document.getElementById(elementId);
    if (!element) return;
    
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <html>
        <head>
            <title>Yazdır</title>
            <style>
                body { font-family: Arial, sans-serif; }
                table { width: 100%; border-collapse: collapse; }
                th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                th { background-color: #f2f2f2; }
            </style>
        </head>
        <body>
            ${element.innerHTML}
        </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.print();
}

// Loading Spinner
function showLoading() {
    const spinner = document.createElement('div');
    spinner.id = 'loading-spinner';
    spinner.innerHTML = '<div class="spinner"></div>';
    spinner.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
    `;
    document.body.appendChild(spinner);
}

function hideLoading() {
    const spinner = document.getElementById('loading-spinner');
    if (spinner) {
        spinner.remove();
    }
}

// Debounce Function
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Initialize tooltips
document.addEventListener('DOMContentLoaded', function() {
    const tooltips = document.querySelectorAll('[data-tooltip]');
    tooltips.forEach(element => {
        element.addEventListener('mouseenter', function() {
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            tooltip.textContent = this.getAttribute('data-tooltip');
            document.body.appendChild(tooltip);
            
            const rect = this.getBoundingClientRect();
            tooltip.style.left = rect.left + (rect.width / 2) - (tooltip.offsetWidth / 2) + 'px';
            tooltip.style.top = rect.top - tooltip.offsetHeight - 5 + 'px';
        });
        
        element.addEventListener('mouseleave', function() {
            const tooltip = document.querySelector('.tooltip');
            if (tooltip) tooltip.remove();
        });
    });
});

25. APP/VIEWS/LAYOUTS/HEADER.PHP
php<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?= $title ?? APP_NAME ?></title>
    <link rel="stylesheet" href="<?= BASE_URL ?>/assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <?php $flash = getFlashMessage(); ?>
    <?php if ($flash): ?>
        <div class="alert alert-<?= $flash['type'] ?>">
            <?= $flash['message'] ?>
        </div>
    <?php endif; ?>

26. APP/VIEWS/LAYOUTS/FOOTER.PHP
php    <script src="<?= BASE_URL ?>/assets/js/main.js"></script>
    <?php if (isset($extraScripts)): ?>
        <?= $extraScripts ?>
    <?php endif; ?>
</body>
</html>

27. APP/VIEWS/LAYOUTS/SIDEBAR_ADMIN.PHP
php<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <h3><?= APP_NAME ?></h3>
    </div>
    <button class="sidebar-toggle" onclick="document.getElementById('sidebar').classList.toggle('collapsed')">
        <i class="fas fa-bars"></i>
    </button>
    <ul class="sidebar-menu">
        <li>
            <a href="<?= BASE_URL ?>/admin/dashboard" class="<?= $activePage === 'dashboard' ? 'active' : '' ?>">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
        </li>
        <li>
            <a href="<?= BASE_URL ?>/admin/teachers" class="<?= $activePage === 'teachers' ? 'active' : '' ?>">
                <i class="fas fa-chalkboard-teacher"></i>
                <span>Öğretmenler</span>
            </a>
        </li>
        <li>
            <a href="<?= BASE_URL ?>/admin/students" class="<?= $activePage === 'students' ? 'active' : '' ?>">
                <i class="fas fa-user-graduate"></i>
                <span>Öğrenciler</span>
            </a>
        </li>
        <li>
            <a href="<?= BASE_URL ?>/admin/classes" class="<?= $activePage === 'classes' ? 'active' : '' ?>">
                <i class="fas fa-school"></i>
                <span>Sınıflar</span>
            </a>
        </li>
        <li>
            <a href="<?= BASE_URL ?>/admin/subjects" class="<?= $activePage === 'subjects' ? 'active' : '' ?>">
                <i class="fas fa-book"></i>
                <span>Dersler</span>
            </a>
        </li>
        <li>
            <a href="<?= BASE_URL ?>/admin/periods" class="<?= $activePage === 'periods' ? 'active' : '' ?>">
                <i class="fas fa-calendar-alt"></i>
                <span>Dönemler</span>
            </a>
        </li>
        <li>
            <a href="<?= BASE_URL ?>/admin/grades" class="<?= $activePage === 'grades' ? 'active' : '' ?>">
                <i class="fas fa-chart-line"></i>
                <span>Notlar</span>
            </a>
        </li>
        <li>
            <a href="<?= BASE_URL ?>/admin/logs" class="<?= $activePage === 'logs' ? 'active' : '' ?>">
                <i class="fas fa-history"></i>
                <span>Loglar</span>
            </a>
        </li>
        <li>
            <a href="<?= BASE_URL ?>/admin/settings" class="<?= $activePage === 'settings' ? 'active' : '' ?>">
                <i class="fas fa-cog"></i>
                <span>Ayarlar</span>
            </a>
        </li>
        <li>
            <a href="<?= BASE_URL ?>/admin/backup" class="<?= $activePage === 'backup' ? 'active' : '' ?>">
                <i class="fas fa-database"></i>
                <span>Yedekleme</span>
            </a>
        </li>
        <li>
            <a href="<?= BASE_URL ?>/auth/logout">
                <i class="fas fa-sign-out-alt"></i>
                <span>Çıkış</span>
            </a>
        </li>
    </ul>
</div>

28. APP/VIEWS/LAYOUTS/SIDEBAR_TEACHER.PHP
php<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <h3><?= APP_NAME ?></h3>
    </div>
    <button class="sidebar-toggle" onclick="document.getElementById('sidebar').classList.toggle('collapsed')">
        <i class="fas fa-bars"></i>
    </button>
    <ul class="sidebar-menu">
        <li>
            <a href="<?= BASE_URL ?>/teacher/dashboard" class="<?= $activePage === 'dashboard' ? 'active' : '' ?>">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
        </li>
        <li>
            <a href="<?= BASE_URL ?>/teacher/profile" class="<?= $activePage === 'profile' ? 'active' : '' ?>">
                <i class="fas fa-user"></i>
                <span>Profil</span>
            </a>
        </li>
        <li>
            <a href="<?= BASE_URL ?>/teacher/grades" class="<?= $activePage === 'grades' ? 'active' : '' ?>">
                <i class="fas fa-edit"></i>
                <span>Not Girişi</span>
            </a>
        </li>
        <li>
            <a href="<?= BASE_URL ?>/teacher/viewGrades" class="<?= $activePage === 'view_grades' ? 'active' : '' ?>">
                <i class="fas fa-eye"></i>
                <span>Notları Görüntüle</span>
            </a>
        </li>
        <li>
            <a href="<?= BASE_URL ?>/teacher/behaviorNotes" class="<?= $activePage === 'behavior_notes' ? 'active' : '' ?>">
                <i class="fas fa-clipboard"></i>
                <span>Davranış Notları</span>
            </a>
        </li>
        <li>
            <a href="<?= BASE_URL ?>/teacher/missingGrades" class="<?= $activePage === 'missing_grades' ? 'active' : '' ?>">
                <i class="fas fa-exclamation-triangle"></i>
                <span>Eksik Notlar</span>
            </a>
        </li>
        <li>
            <a href